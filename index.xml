<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>HttpRunner – HttpRunner</title><link>https://httprunner.com/</link><description>Recent content on HttpRunner</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://httprunner.com/index.xml" rel="self" type="application/rss+xml"/><item><title>Blog: HttpRunner 如何基于 Prometheus + Grafana 实现性能监控</title><link>https://httprunner.com/blog/how-to-load-monitoring/</link><pubDate>Wed, 18 May 2022 00:00:00 +0000</pubDate><guid>https://httprunner.com/blog/how-to-load-monitoring/</guid><description>
&lt;h2 id="前言">前言&lt;/h2>
&lt;p>在 &lt;a href="https://httprunner.com/blog/how-to-load-test/">如何使用 HttpRunner v4.0 开展性能测试&lt;/a> 中已经介绍过，HttpRunner v4.0 集成了 Prometheus 性能采集能力。也就是说，HttpRunner 可以充分将性能测试数据扩展到 Prometheus 生态，实现更丰富的数据应用场景，开展性能监控。&lt;/p>
&lt;p>本文将会从 Prometheus 监控系统作为切入点，帮助大家快速理解 HttpRunner 性能监控链路，并提供快速上手帮助大家快速实现性能监控。&lt;/p>
&lt;h2 id="原理介绍">原理介绍&lt;/h2>
&lt;p>本节介绍 Prometheus 监控系统，帮助大家快速理解使用 HttpRunner v4.0 开展性能监控原理。&lt;/p>
&lt;p>Prometheus 的系统架构图如下：&lt;/p>
&lt;p>&lt;img src="https://httprunner.com/image/prometheus-architecture.png" alt="Prometheus系统架构图">&lt;/p>
&lt;p>整个 Prometheus 系统框架主要包含四个部分：&lt;/p>
&lt;ul>
&lt;li>Server：提供指标汇总、存储、查询能力&lt;/li>
&lt;li>Exporter：提供指标采集能力&lt;/li>
&lt;li>Data Visualization：提供指标数据可视化能力&lt;/li>
&lt;li>Alerting：提供告警能力&lt;/li>
&lt;/ul>
&lt;p>如上可知，Prometheus 打通了从指标采集、汇总、存储、查询、可视化、告警链路，实现了完备的监控告警系统。针对 HttpRunner 性能监控场景，本文仅提供最小链路 Server、Exporter、Data Visualization 部分能力的快速上手，Alerting 等功能大家可以根据实际需求进行配置。&lt;/p>
&lt;p>在 Prometheus 系统框架中，HttpRunner 实现了指标采集的能力，其本身就是一个 Exporter。因此，我们仅需要将指标上报至 Prometheus Server 链路打通即可实现性能监控。Prometheus 提供的两种指标收集方式：&lt;/p>
&lt;ol>
&lt;li>Exporter 会启动一个 http server，将采集的指标以固定的文本格式返回给请求方，Prometheus Server直接拉取；&lt;/li>
&lt;li>将指标直接 push 到 Prometheus 提供的数据网关 pushgateway 中，Prometheus Server 再从 pushgateway 中拉取指标数据。&lt;/li>
&lt;/ol>
&lt;p>两种方式中，HttpRunner 仅提供第二种方式的支持，即在使用 hrp boom 运行性能测试过程中主动 push 性能测试数据到 Pushgateway 的方式。这样做的原因有如下几点：&lt;/p>
&lt;ol>
&lt;li>减少 Prometheus 侧的配置压力，避免 Exporter 的 IP 变化或在分布式压测场景下新增 Worker 后需要再次修改 Prometheus 的配置文件才能拉取到 Worker 数据的问题，理想情况是 Prometheus 侧对 Worker 数量是无感知的&lt;/li>
&lt;li>更通用的应用场景，比如当 Server 部署在公网，而 Exporter 部署在内网等场景下，可避免公网环境不能访问到内网的情况&lt;/li>
&lt;li>避免每个 Worker 启动一个 Http Server 带来端口占用问题以及暴露网络端口的安全风险&lt;/li>
&lt;/ol>
&lt;p>基于第二种方式，Prometheus Server 端仅需从 Pushgateway 上实时拉取到最新的性能测试数据，并将数据汇总存储在本地的时序数据库中即可。到此，我们可以通过 PromQL 语句在 Prometheus Web UI 上对指标进行聚合查询了，也可以在 Grafana 中使用更丰富生动的面板进行数据可视化（推荐）。&lt;/p>
&lt;p>整个监控链路可简化为：&lt;/p>
&lt;p>&lt;img src="https://httprunner.com/image/prometheus-httprunner.svg" alt="Prometheus系统架构图">&lt;/p>
&lt;h2 id="快速上手">快速上手&lt;/h2>
&lt;p>本节将介绍如何从零搭建 Prometheus 服务，打通性能监控链路，帮助大家能快速上手。&lt;/p>
&lt;h3 id="配置prometheus">配置Prometheus&lt;/h3>
&lt;p>在官网 &lt;a href="https://prometheus.io/download/">Download | Prometheus&lt;/a> 下载 prometheus 与 pushgateway，并进行如下配置。&lt;/p>
&lt;h4 id="pushgateway">Pushgateway&lt;/h4>
&lt;p>Pushgateway 不需要修改任何配置文件，直接运行可执行文件即可启动，默认端口号为 9091，如需更改端口号，需启动时指定。启动 Pushgateway：&lt;/p>
&lt;pre tabindex="0">&lt;code>./pushgateway --web.listen-address=&amp;quot;:9091&amp;quot;
&lt;/code>&lt;/pre>&lt;h4 id="prometheus-server">Prometheus Server&lt;/h4>
&lt;p>启动 Server 前需要手动更改 prometheus.yml 配置文件，明确拉取指标的实例地址（本案例中的 Pushgateway 地址）与 Server 拉取 Pushgateway 实例的时间间隔（ scrape_interval ），具体更改如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yml" data-lang="yml">&lt;span style="color:#204a87;font-weight:bold">global&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">scrape_interval&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">15s&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># By default, scrape targets every 15 seconds.&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">evaluation_interval&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">15s&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># Evaluate rules every 15 seconds.&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># Attach these extra labels to all timeseries collected by this Prometheus instance.&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">external_labels&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">monitor&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#39;codelab-monitor&amp;#39;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">rule_files&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#4e9a06">&amp;#39;prometheus.rules.yml&amp;#39;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">scrape_configs&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">job_name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#39;prometheus&amp;#39;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># Override the global default and scrape targets from this job every 5 seconds.&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">scrape_interval&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">5s&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">static_configs&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">targets&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;localhost:9090&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">job_name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#39;pushgateway&amp;#39;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># metrics_path defaults to &amp;#39;/metrics&amp;#39; # scheme defaults to &amp;#39;http&amp;#39;.&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">scrape_interval&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">3s&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">static_configs&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">targets&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;localhost:9091&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">labels&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">instance&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">httprunner&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>注意：Pushgateway 的 scrape_interval 需要与 HttpRunner 上报数据频率保持一致，即设置为 3s。&lt;/p>
&lt;p>启动 Prometheus Server：&lt;/p>
&lt;pre tabindex="0">&lt;code>./prometheus --config.file=prometheus.yml
&lt;/code>&lt;/pre>&lt;h3 id="配置httprunner">配置HttpRunner&lt;/h3>
&lt;p>配置 HttpRunner 就比较简单了，在使用 hrp boom 启动性能测试时通过 prometheus-gateway 参数设置 Pushgateway 地址即可，如 &lt;code>--prometheus-gateway=&amp;quot;:9091&amp;quot;&lt;/code>。在性能过程中，HttpRunner 会以 3s 的数据上报间隔将性能测试指标上报到 Pushgateway。&lt;/p>
&lt;h3 id="配置grafana">配置Grafana&lt;/h3>
&lt;p>Grafana 的快速上手可以参考：&lt;a href="https://prometheus.io/docs/visualization/grafana/">Grafana | Prometheus&lt;/a> ，不再赘述。&lt;/p>
&lt;p>本文提供 &lt;code>hrp boom&lt;/code> 单机模式的 Dashboard 模板，大家在 HttpRunner 公众号回复「Grafana」获取模板下载地址，然后导入 Grafana 中即可使用。&lt;/p>
&lt;blockquote>
&lt;p>注：分布式场景的 Grafana Dashboard 模板，待 HttpRunner 上线分布式性能测试能力后再提供。&lt;/p>
&lt;/blockquote>
&lt;img src="https://httprunner.com/image/qrcode.png" alt="HttpRunner" width="300">
&lt;p>模板最终效果如下:&lt;/p>
&lt;p>&lt;img src="https://httprunner.com/image/demo-grafana.png" alt="Grafana Dashboard 1">&lt;/p>
&lt;p>&lt;img src="https://httprunner.com/image/demo-grafana-2.png" alt="Grafana Dashboard 2">&lt;/p>
&lt;h2 id="指标说明">指标说明&lt;/h2>
&lt;p>本节将介绍 HttpRunner 上报的指标说明，大家可以根据需要再丰富本文提供的 Grafana Dashboard 模板。&lt;/p>
&lt;p>HttpRunner 上报至 Prometheus 指标具体可分为两大类：&lt;/p>
&lt;ul>
&lt;li>3s统计间隔内的性能测试指标，可实时监控最新性能数据详情&lt;/li>
&lt;li>整体性能测试指标，可实时监控测试过程的整体性能指标&lt;/li>
&lt;/ul>
&lt;p>指标名称与具体说明如下:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:center">指标名称&lt;/th>
&lt;th style="text-align:center">指标说明&lt;/th>
&lt;th style="text-align:center">指标类型&lt;/th>
&lt;th style="text-align:center">标签&lt;/th>
&lt;th style="text-align:center">统计间隔&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:center">num_requests&lt;/td>
&lt;td style="text-align:center">The number of requests&lt;/td>
&lt;td style="text-align:center">GaugeVec&lt;/td>
&lt;td style="text-align:center">name、method&lt;/td>
&lt;td style="text-align:center">3s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">num_failures&lt;/td>
&lt;td style="text-align:center">The number of failures&lt;/td>
&lt;td style="text-align:center">GaugeVec&lt;/td>
&lt;td style="text-align:center">name、method&lt;/td>
&lt;td style="text-align:center">3s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">median_response_time&lt;/td>
&lt;td style="text-align:center">The median response time&lt;/td>
&lt;td style="text-align:center">GaugeVec&lt;/td>
&lt;td style="text-align:center">name、method&lt;/td>
&lt;td style="text-align:center">3s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">average_response_time&lt;/td>
&lt;td style="text-align:center">The average response time&lt;/td>
&lt;td style="text-align:center">GaugeVec&lt;/td>
&lt;td style="text-align:center">name、method&lt;/td>
&lt;td style="text-align:center">3s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">min_response_time&lt;/td>
&lt;td style="text-align:center">The min response time&lt;/td>
&lt;td style="text-align:center">GaugeVec&lt;/td>
&lt;td style="text-align:center">name、method&lt;/td>
&lt;td style="text-align:center">3s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">max_response_time&lt;/td>
&lt;td style="text-align:center">The max response time&lt;/td>
&lt;td style="text-align:center">GaugeVec&lt;/td>
&lt;td style="text-align:center">name、method&lt;/td>
&lt;td style="text-align:center">3s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">average_content_length&lt;/td>
&lt;td style="text-align:center">The average content length&lt;/td>
&lt;td style="text-align:center">GaugeVec&lt;/td>
&lt;td style="text-align:center">name、method&lt;/td>
&lt;td style="text-align:center">3s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">current_rps&lt;/td>
&lt;td style="text-align:center">The current requests per second&lt;/td>
&lt;td style="text-align:center">GaugeVec&lt;/td>
&lt;td style="text-align:center">name、method&lt;/td>
&lt;td style="text-align:center">3s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">current_fail_per_sec&lt;/td>
&lt;td style="text-align:center">The current failure number per second&lt;/td>
&lt;td style="text-align:center">GaugeVec&lt;/td>
&lt;td style="text-align:center">name、method&lt;/td>
&lt;td style="text-align:center">3s&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">total_num_requests&lt;/td>
&lt;td style="text-align:center">The number of requests in total&lt;/td>
&lt;td style="text-align:center">CounterVec&lt;/td>
&lt;td style="text-align:center">method、name&lt;/td>
&lt;td style="text-align:center">total&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">total_num_failures&lt;/td>
&lt;td style="text-align:center">The number of failures in total&lt;/td>
&lt;td style="text-align:center">CounterVec&lt;/td>
&lt;td style="text-align:center">method、name&lt;/td>
&lt;td style="text-align:center">total&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">errors&lt;/td>
&lt;td style="text-align:center">The errors of load testing&lt;/td>
&lt;td style="text-align:center">CounterVec&lt;/td>
&lt;td style="text-align:center">method、name、error&lt;/td>
&lt;td style="text-align:center">total&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">response_time&lt;/td>
&lt;td style="text-align:center">The summary of response time（PCT50/PCT90/PCT95）&lt;/td>
&lt;td style="text-align:center">SummaryVec&lt;/td>
&lt;td style="text-align:center">name、method&lt;/td>
&lt;td style="text-align:center">total&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">users&lt;/td>
&lt;td style="text-align:center">The current number of users&lt;/td>
&lt;td style="text-align:center">Gauge&lt;/td>
&lt;td style="text-align:center">N/A&lt;/td>
&lt;td style="text-align:center">total&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">state&lt;/td>
&lt;td style="text-align:center">The current runner state, 1=initializing, 2=spawning, 3=running, 4=quitting, 5=stopped&lt;/td>
&lt;td style="text-align:center">Gauge&lt;/td>
&lt;td style="text-align:center">N/A&lt;/td>
&lt;td style="text-align:center">total&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">duration&lt;/td>
&lt;td style="text-align:center">The duration of load testing&lt;/td>
&lt;td style="text-align:center">Gauge&lt;/td>
&lt;td style="text-align:center">N/A&lt;/td>
&lt;td style="text-align:center">total&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">total_average_response_time&lt;/td>
&lt;td style="text-align:center">The average response time in total milliseconds&lt;/td>
&lt;td style="text-align:center">Gauge&lt;/td>
&lt;td style="text-align:center">N/A&lt;/td>
&lt;td style="text-align:center">total&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">total_min_response_time&lt;/td>
&lt;td style="text-align:center">The min response time in total milliseconds&lt;/td>
&lt;td style="text-align:center">GaugeVec&lt;/td>
&lt;td style="text-align:center">name、method&lt;/td>
&lt;td style="text-align:center">total&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">total_max_response_time&lt;/td>
&lt;td style="text-align:center">The max response time in total milliseconds&lt;/td>
&lt;td style="text-align:center">GaugeVec&lt;/td>
&lt;td style="text-align:center">name、method&lt;/td>
&lt;td style="text-align:center">total&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">total_rps&lt;/td>
&lt;td style="text-align:center">The requests per second in total&lt;/td>
&lt;td style="text-align:center">Gauge&lt;/td>
&lt;td style="text-align:center">N/A&lt;/td>
&lt;td style="text-align:center">total&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">fail_ratio&lt;/td>
&lt;td style="text-align:center">The ratio of request failures in total&lt;/td>
&lt;td style="text-align:center">Gauge&lt;/td>
&lt;td style="text-align:center">N/A&lt;/td>
&lt;td style="text-align:center">total&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">total_fail_per_sec&lt;/td>
&lt;td style="text-align:center">The failure number per second in total&lt;/td>
&lt;td style="text-align:center">Gauge&lt;/td>
&lt;td style="text-align:center">N/A&lt;/td>
&lt;td style="text-align:center">total&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">transactions_passed&lt;/td>
&lt;td style="text-align:center">The accumulated number of passed transactions&lt;/td>
&lt;td style="text-align:center">Gauge&lt;/td>
&lt;td style="text-align:center">N/A&lt;/td>
&lt;td style="text-align:center">total&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">transactions_failed&lt;/td>
&lt;td style="text-align:center">The accumulated number of failed transactions&lt;/td>
&lt;td style="text-align:center">Gauge&lt;/td>
&lt;td style="text-align:center">N/A&lt;/td>
&lt;td style="text-align:center">total&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="结语">结语&lt;/h2>
&lt;p>通过以上内容，相信大家对 HttpRunner v4.0 的性能监控链路有了一个整体认识，我们可以使用 HttpRunner v4.0 在开展性能测试的同时进行性能监控，欢迎大家多多实践。&lt;/p>
&lt;p>接下来，我们将连载介绍 HttpRunner v4.0 的更多性能测试功能特性，敬请期待。&lt;/p>
&lt;blockquote>
&lt;p>本文作者：&lt;a href="https://github.com/xucong053">xucong053&lt;/a>，HttpRunner 核心开发者，重点建设了性能测试相关能力&lt;br/>
HttpRunner 项目官网: &lt;a href="https://httprunner.com/">https://httprunner.com/&lt;/a>&lt;br/>
如果 HttpRunner 对你有过帮助，麻烦帮忙给个 ⭐️star⭐️ 鼓励下吧&lt;br/>
&lt;a href="https://github.com/httprunner/httprunner">https://github.com/httprunner/httprunner&lt;/a>&lt;/p>
&lt;/blockquote></description></item><item><title>Blog: 如何使用 HttpRunner v4.0 开展性能测试</title><link>https://httprunner.com/blog/how-to-load-test/</link><pubDate>Mon, 16 May 2022 00:00:00 +0000</pubDate><guid>https://httprunner.com/blog/how-to-load-test/</guid><description>
&lt;h2 id="前言">前言&lt;/h2>
&lt;p>在 &lt;a href="https://httprunner.com/blog/release-v4/">HttpRunner v4.0 全新发布&lt;/a> 中我们有介绍过，HttpRunner v4.0 期望成为一款专业级的一体化 API 测试工具，特别是针对性能测试能力进行了重大升级。相比于之前的版本，HttpRunner v4.0 在性能测试部分最大的优化包括如下 4 个方面：&lt;/p>
&lt;ul>
&lt;li>使用 Golang 重新实现了脚本执行引擎（基于 &lt;a href="https://github.com/myzhan/boomer">Boomer&lt;/a>），相比于 Python Locust 极大地提升了发压能力&lt;/li>
&lt;li>对标 LoadRunner 新增实现了丰富的性能测试机制，包括事务、集合点、思考时间等&lt;/li>
&lt;li>对压测结果进行了严格的 benchmark 测试和数据校准，确保测试结果真实可靠&lt;/li>
&lt;li>集成了 Prometheus 性能采集能力，配合 Grafana 可实现丰富的性能指标看板&lt;/li>
&lt;/ul>
&lt;p>涉及的内容比较多，因此我们针对 HttpRunner v4.0 的性能测试能力规划了一系列专题文章，包括性能测试工具使用、多机负载分布式加压、监控配置、benchmark 数据比对、竞品工具对比、原理解析等等。&lt;/p>
&lt;p>本文作为性能测试专题的第一篇文章，将结合一个简单的案例整体介绍如何使用 HttpRunner v4.0 开展性能测试，帮助大家快速上手使用工具。&lt;/p>
&lt;h2 id="案例介绍">案例介绍&lt;/h2>
&lt;p>为了方便大家理解，本文挑选了一个非常简单的案例场景，但同时会尽量多地覆盖常用的性能测试特性。&lt;/p>
&lt;p>案例设计如下：&lt;/p>
&lt;ul>
&lt;li>压测目标为 3 个接口：API1/API2/API3&lt;/li>
&lt;li>业务层面期望整体关注 API1 + API2 的性能情况，即「事务」特性&lt;/li>
&lt;li>在真实场景中，API1 和 API2 请求之间需要有一个间隔时间，即「思考时间」特性&lt;/li>
&lt;li>期望重点关注 API3 的并发性能，即所有用户同一时间请求的情况，即「集合点」特性&lt;/li>
&lt;/ul>
&lt;p>接下来，我们将对这些特性进行具体介绍，并对使用方法进行演示说明。&lt;/p>
&lt;h2 id="编写测试用例">编写测试用例&lt;/h2>
&lt;p>在性能测试之前，我们需要先准备好性能测试用例。在 HttpRunner 中，得益于「一体化」的特性优势，我们可以在无需对已有接口测试用例做任何修改的情况下，直接运行性能测试。&lt;/p>
&lt;p>针对本文中的案例，接口测试用例如下所示：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#204a87;font-weight:bold">config&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">load test demo&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">variables&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">app_version&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">user_agent&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">iOS/10.3&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">base_url&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#39;http://httpbin.org&amp;#39;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">verify&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">false&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">teststeps&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">get with params&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">request&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">method&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">GET&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">url&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">/get&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">headers&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">User-Agent&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#39;$user_agent/$app_version&amp;#39;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">validate&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">check&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">status_code&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">assert&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">equals&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">expect&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">200&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">msg&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">check status code&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">post with params&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">request&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">method&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">POST&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">url&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">/post&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">headers&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">User-Agent&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#39;$user_agent/$app_version&amp;#39;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">validate&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">check&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">status_code&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">assert&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">equals&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">expect&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">200&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">msg&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">check status code&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">post with params 2&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">request&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">method&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">POST&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">url&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">/post&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">headers&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">User-Agent&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#39;$user_agent/$app_version&amp;#39;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">validate&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">check&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">status_code&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">assert&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">equals&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">expect&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">200&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">msg&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">check status code&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>我们只需将测试命令从 &lt;code>hrp run&lt;/code> 改为 &lt;code>hrp boom&lt;/code>，即可启动性能测试，具体的参数配置后面会详细介绍。&lt;/p>
&lt;p>需要说明的是：&lt;/p>
&lt;ul>
&lt;li>HttpRunner v4.0 做性能测试时，测试用例格式只能选择 YAML/JSON/GoTest；PyTest 格式的底层引擎基于 pytest 执行引擎，不支持性能测试；&lt;/li>
&lt;li>如果我们在性能测试中期望实现「事务」、「集合点」、「思考时间」等机制，需要在接口测试用例基础上添加特定的步骤。&lt;/li>
&lt;/ul>
&lt;h3 id="添加事务机制">添加「事务」机制&lt;/h3>
&lt;p>事务可以将多个接口的测试结果进行聚合统计，性能指标更加贴合真实业务场景。&lt;/p>
&lt;p>事务的数据结构如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Transaction&lt;/span> &lt;span style="color:#204a87;font-weight:bold">struct&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">Name&lt;/span> &lt;span style="color:#204a87;font-weight:bold">string&lt;/span> &lt;span style="color:#4e9a06">`json:&amp;#34;name&amp;#34; yaml:&amp;#34;name&amp;#34;`&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// 事务名称，可定义为任意字符串
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000">Type&lt;/span> &lt;span style="color:#000">transactionType&lt;/span> &lt;span style="color:#4e9a06">`json:&amp;#34;type&amp;#34; yaml:&amp;#34;type&amp;#34;`&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// 事务类型，仅包括 2 种类型，start（事务开始）和 end（结束事务）
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>事务使用示例：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#204a87;font-weight:bold">config&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">...&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">teststeps&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">...&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">transaction 1 start&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">transaction&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">tran1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">start&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">...&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">transaction 1 end&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">transaction&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">tran1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">end&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">...&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>针对「事务」机制，有 2 个需要特别注意的点：&lt;/p>
&lt;ul>
&lt;li>使用 HttpRunner v4.0 执行性能测试时，会自动添加名称为 Action 的事务，该事务包含整个测试用例的所有测试步骤（参考了 LoadRunner 的做法）&lt;/li>
&lt;li>在测试用例中，transaction 应该成对出现，即必须同时定义 start 和 end；如果存在配对缺失的情况，会按照如下逻辑进行处理：
&lt;ul>
&lt;li>仅设置开始事务，则会在测试用例最后一个测试步后添加结束事务&lt;/li>
&lt;li>仅设置结束事务，则会在测试用例第一个测试步前添加开始事务&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="添加集合点机制">添加「集合点」机制&lt;/h3>
&lt;p>集合点可以确保指定的虚拟用户在同一时刻发起请求，实现类似”秒杀“的真实业务场景。&lt;/p>
&lt;p>集合点的数据结构如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">Rendezvous&lt;/span> &lt;span style="color:#204a87;font-weight:bold">struct&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">Name&lt;/span> &lt;span style="color:#204a87;font-weight:bold">string&lt;/span> &lt;span style="color:#4e9a06">`json:&amp;#34;name&amp;#34; yaml:&amp;#34;name&amp;#34;`&lt;/span>
&lt;span style="color:#000">Percent&lt;/span> &lt;span style="color:#204a87;font-weight:bold">float32&lt;/span> &lt;span style="color:#4e9a06">`json:&amp;#34;percent,omitempty&amp;#34; yaml:&amp;#34;percent,omitempty&amp;#34;`&lt;/span>
&lt;span style="color:#000">Number&lt;/span> &lt;span style="color:#204a87;font-weight:bold">int64&lt;/span> &lt;span style="color:#4e9a06">`json:&amp;#34;number,omitempty&amp;#34; yaml:&amp;#34;number,omitempty&amp;#34;`&lt;/span>
&lt;span style="color:#000">Timeout&lt;/span> &lt;span style="color:#204a87;font-weight:bold">int64&lt;/span> &lt;span style="color:#4e9a06">`json:&amp;#34;timeout,omitempty&amp;#34; yaml:&amp;#34;timeout,omitempty&amp;#34;`&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>集合点数据结构参数说明如下：&lt;/p>
&lt;ul>
&lt;li>name: 集合点名称，可定义为任意字符串&lt;/li>
&lt;li>percent: 触发集合点释放的虚拟用户百分比，范围为 (0, 1]，默认为 1，即全部用户&lt;/li>
&lt;li>number: 触发集合点释放的虚拟用户数量，范围为 (0, N]，N 为当前性能测试的所有并发用户数&lt;/li>
&lt;li>timeout: 虚拟用户到达集合点之间的间隔时间的最大值，单位为毫秒；当最近两个虚拟用户达到集合点的时间间隔大于最大值，则立即释放所有虚拟用户，如果没有指定，默认值为 5000 ms&lt;/li>
&lt;/ul>
&lt;p>集合点使用示例：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#204a87;font-weight:bold">config&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">...&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">teststeps&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">...&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">rendezvous 1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">rendezvous&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">rendezvous1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">number&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">50&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">timeout&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">3000&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">...&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">rendezvous 2&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">rendezvous&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">rendezvous2&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">percent&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">0.8&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">timeout&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">3000&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">...&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>针对「集合点」机制，有 2 个需要特别注意的点：&lt;/p>
&lt;ul>
&lt;li>number 和 percent 参数需要二选一并且保证合法；如果没有指定参数、同时指定了两个参数、或者参数不合法，则默认为需要全部虚拟用户到达集合点。&lt;/li>
&lt;li>集合点仅在虚拟用户全部加载完之后的稳定阶段生效。&lt;/li>
&lt;/ul>
&lt;p>可以看出，HttpRunner v4.0 的「集合点」机制也跟 LoadRunner 保持了一致，功能特性和参数配置方法完全相同。&lt;/p>
&lt;h3 id="添加思考时间机制">添加「思考时间」机制&lt;/h3>
&lt;p>思考时间可以模拟用户在不同操作间的停顿时间，最大程度还原用户真实的操作行为。&lt;/p>
&lt;p>思考时间的数据结构如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">ThinkTimeConfig&lt;/span> &lt;span style="color:#204a87;font-weight:bold">struct&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">Strategy&lt;/span> &lt;span style="color:#000">thinkTimeStrategy&lt;/span> &lt;span style="color:#4e9a06">`json:&amp;#34;strategy,omitempty&amp;#34; yaml:&amp;#34;strategy,omitempty&amp;#34;`&lt;/span>
&lt;span style="color:#000">Setting&lt;/span> &lt;span style="color:#204a87;font-weight:bold">interface&lt;/span>&lt;span style="color:#000;font-weight:bold">{}&lt;/span> &lt;span style="color:#4e9a06">`json:&amp;#34;setting,omitempty&amp;#34; yaml:&amp;#34;setting,omitempty&amp;#34;`&lt;/span>
&lt;span style="color:#000">Limit&lt;/span> &lt;span style="color:#204a87;font-weight:bold">float64&lt;/span> &lt;span style="color:#4e9a06">`json:&amp;#34;limit,omitempty&amp;#34; yaml:&amp;#34;limit,omitempty&amp;#34;`&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">type&lt;/span> &lt;span style="color:#000">ThinkTime&lt;/span> &lt;span style="color:#204a87;font-weight:bold">struct&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">Time&lt;/span> &lt;span style="color:#204a87;font-weight:bold">float64&lt;/span> &lt;span style="color:#4e9a06">`json:&amp;#34;time&amp;#34; yaml:&amp;#34;time&amp;#34;`&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>其中，&lt;code>ThinkTimeConfig&lt;/code> 作为「思考时间」的整体策略，需要在测试用例的 &lt;code>Config&lt;/code> 中配置，参数说明如下：&lt;/p>
&lt;ul>
&lt;li>Strategy (支持如下四种策略)
&lt;ul>
&lt;li>default: 默认策略，会保持测试用例中设置的思考时间&lt;/li>
&lt;li>random_percentage: 测试用例中设置的思考时间在指定放缩区间中随机选值&lt;/li>
&lt;li>multiply: 对测试用例中设置的思考时间进行放缩&lt;/li>
&lt;li>ignore: 忽略测试用例中设置的思考时间&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Setting (仅需random_percentage、multiply策略下配置，其他模式自动忽略此设置)
&lt;ul>
&lt;li>random_percentage：此策略下，需设置思考时间的最小最大放缩比：min_percentage、max_percentage（设置类型为map），默认: [0.5, 1.5]&lt;/li>
&lt;li>multiply：此策略下，直接设置放缩比例（设置类型为float），默认: 1&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Limit
&lt;ul>
&lt;li>对所有策略有效，如果设置且大于0，则限制最终的思考时间&amp;lt;=设定值，默认: -1(无限制)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;code>ThinkTime&lt;/code> 作为具体步骤间的「思考时间」配置，以单独的 step 存在，参数说明如下：&lt;/p>
&lt;ul>
&lt;li>time: 不同测试步间的思考时间，单位为秒（second）&lt;/li>
&lt;/ul>
&lt;p>思考时间使用示例如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#204a87;font-weight:bold">config&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">...&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">think_time&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">strategy&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">random_percentage&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">setting&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">min_percentage&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">max_percentage&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1.5&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">limit&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">4&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">...&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">teststeps&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">...&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">think time 1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">think_time&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">time&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">...&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">think time 2&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">think_time&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">time&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">3&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">...&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在该示例中，思考时间策略为随机比例（&lt;code>random_percentage&lt;/code>），介于 100% ~ 150% 之间；limit 设置为 4s。经过换算，测试步骤中的 &lt;code>think time 1&lt;/code> 的最终值在 [2, 3]s 之间，&lt;code>think time 2&lt;/code> 的最终值在 [3, 4]s 之间。&lt;/p>
&lt;h3 id="用例格式示例">用例格式示例&lt;/h3>
&lt;p>经过对已有的接口测试用例进行增强，我们获得了包含「事务」、「集合点」、「思考时间」机制的性能测试用例。&lt;/p>
&lt;p>YAML 用例格式的示例如下所示：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#204a87;font-weight:bold">config&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">load test demo&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">variables&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">app_version&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">user_agent&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">iOS/10.3&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">base_url&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#39;http://httpbin.org&amp;#39;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">think_time&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">strategy&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">random_percentage&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">setting&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">min_percentage&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">max_percentage&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1.5&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">limit&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">verify&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">false&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">teststeps&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">transaction 1 start&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">transaction&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">tran1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">start&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">get with params&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">request&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">method&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">GET&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">url&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">/get&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">headers&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">User-Agent&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#39;$user_agent,$app_version&amp;#39;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">validate&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">check&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">status_code&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">assert&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">equals&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">expect&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">200&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">msg&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">check status code&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">transaction 1 end&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">transaction&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">tran1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">end&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">think time 1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">think_time&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">time&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1.5&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">post with params&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">request&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">method&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">POST&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">url&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">/post&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">headers&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">User-Agent&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#39;$user_agent,$app_version&amp;#39;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">validate&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">check&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">status_code&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">assert&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">equals&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">expect&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">200&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">msg&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">check status code&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">rendezvous 1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">rendezvous&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">rendezvous1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">percent&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">0.8&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">timeout&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">3000&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">post with params 2&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">request&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">method&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">POST&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">url&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">/post&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">headers&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">User-Agent&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#39;$user_agent,$app_version&amp;#39;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">validate&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">check&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">status_code&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">assert&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">equals&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">expect&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">200&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">msg&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">check status code&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>对应的 GoTest 用例格式示例如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#204a87;font-weight:bold">package&lt;/span> &lt;span style="color:#000">tests&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">import&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;testing&amp;#34;&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;time&amp;#34;&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;github.com/httprunner/httprunner/v4/hrp&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000">TestLoadTestDemo&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">t&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">testing&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">T&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">testcase1&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">TestCase&lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">Config&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewConfig&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;Load Test Demo&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">SetBaseURL&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;http://httpbin.org&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">SetThinkTime&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;random_percentage&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">map&lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#204a87;font-weight:bold">string&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>&lt;span style="color:#204a87;font-weight:bold">float64&lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;min_percentage&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;max_percentage&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1.5&lt;/span>&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#0000cf;font-weight:bold">4&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000">TestSteps&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[]&lt;/span>&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">IStep&lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewStep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;transation 1 start&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">StartTransaction&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;trans1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewStep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;headers&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">GET&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/headers&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">Validate&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">AssertEqual&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;status_code&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">200&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;check status code&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">AssertEqual&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;headers.\&amp;#34;Content-Type\&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;application/json&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;check http response Content-Type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewStep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;transation 1 end&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">EndTransaction&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;trans1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewStep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;think time1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">SetThinkTime&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">3&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewStep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;user-agent&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">GET&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/user-agent&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">Validate&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">AssertEqual&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;status_code&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">200&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;check status code&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">AssertEqual&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;headers.\&amp;#34;Content-Type\&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;application/json&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;check http response Content-Type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewStep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;rendezvous 1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">SetRendezvous&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;rend1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WithUserPercent&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">0.8&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WithTimeout&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">3000&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewStep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;TestCaseRef&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">CallRefCase&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">TestCase&lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#000">Config&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewConfig&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;TestCase2&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">)}),&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000">b&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewStandaloneBoomer&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1000&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">100&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#8f5902;font-style:italic">//spawn_count: 1000, spawn_rate: 100
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#204a87;font-weight:bold">go&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Run&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">testcase1&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;span style="color:#000">time&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Sleep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1000&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span> &lt;span style="color:#000">time&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Second&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#8f5902;font-style:italic">//expected running time
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Quit&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="性能测试参数配置">性能测试参数配置&lt;/h2>
&lt;p>准备好性能测试用例后，我们就可以开始执行性能测试了。&lt;/p>
&lt;p>当前 HttpRunner v4.0 支持多种性能测试策略，我们可以在命令行参数中进行指定。&lt;/p>
&lt;p>关于性能测试的参数信息，可以通过 &lt;code>hrp boom -h&lt;/code> 进行查看。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-text" data-lang="text">$ hrp boom --help
run yaml/json testcase files for load test
Usage:
hrp boom [flags]
Examples:
$ hrp boom demo.json # run specified json testcase file
$ hrp boom demo.yaml # run specified yaml testcase file
$ hrp boom examples/ # run testcases in specified folder
Flags:
--cpu-profile string Enable CPU profiling.
--cpu-profile-duration duration CPU profile duration. (default 30s)
--disable-compression Disable compression
--disable-console-output Disable console output.
--disable-keepalive Disable keepalive
-h, --help help for boom
--loop-count int The specify running cycles for load testing (default -1)
--max-rps int Max RPS that boomer can generate, disabled by default.
--mem-profile string Enable memory profiling.
--mem-profile-duration duration Memory profile duration. (default 30s)
--prometheus-gateway string Prometheus Pushgateway url.
--request-increase-rate string Request increase rate, disabled by default. (default &amp;#34;-1&amp;#34;)
--spawn-count int The number of users to spawn for load testing (default 1)
--spawn-rate float The rate for spawning users (default 1)
Global Flags:
--log-json set log to json format
-l, --log-level string set log level (default &amp;#34;INFO&amp;#34;)
&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果你之前使用过 Locust/Boomer，你会发现参数名称很眼熟。是的，我们直接复用了 Locust/Boomer 的参数名称，虽然底层实现进行了比较大的改造，但用法基本保持了一致，你可以对比查看下 Boomer 的&lt;a href="https://boomer.readthedocs.io/en/latest/options.html">参数文档&lt;/a>。&lt;/p>
&lt;p>参数看上去比较多，接下来对其按照用途进行分组介绍。&lt;/p>
&lt;h3 id="设置并发用户数">设置并发用户数&lt;/h3>
&lt;p>性能测试需要指定并发用户数，同时在很多时候我们需要按照阶梯加压的方式初始化并发用户。这里就需要使用到 &lt;code>--spawn-count&lt;/code> 和 &lt;code>--spawn-rate&lt;/code> 两个参数了。&lt;/p>
&lt;ul>
&lt;li>spawn-count：表示我们期望达到的最大并发用户数&lt;/li>
&lt;li>spawn-rate：表示达到期望最大并发前每秒增加的并发用户数&lt;/li>
&lt;/ul>
&lt;p>具体示例如下所示：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">$ hrp boom testcase.yml --spawn-count &lt;span style="color:#0000cf;font-weight:bold">1000&lt;/span> --spawn-rate &lt;span style="color:#0000cf;font-weight:bold">100&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>在该示例中，我们指定了 1000 并发用户，按照每秒 100 个的速率初始化用户，预计在 10s 后可完成初始化。&lt;/p>
&lt;p>在这种模式下，性能测试不会自动结束（后面我们会再新增支持指定压测时长的参数）；当我们期望结束压测时，可以通过 kill 命令杀死进程，或者 &lt;code>ctrl+c&lt;/code> 来结束性能测试，结束时终端会打印整体测试数据。&lt;/p>
&lt;h3 id="设置-ratelimiter">设置 RateLimiter&lt;/h3>
&lt;p>有时我们需要在性能测试时对发压流量进行限流，例如期望设置最大 RPS，或者在初始化并发用户时限定增加数率。这就需要使用到 &lt;code>--max-rps&lt;/code> 和 &lt;code>--request-increase-rate&lt;/code>。&lt;/p>
&lt;ul>
&lt;li>max-rps：限制 hrp 发压的最大 rps，默认不限制&lt;/li>
&lt;li>request-increase-rate：限制 hrp 每秒的请求增加速率，默认不开启，支持两种格式：&amp;ldquo;1&amp;rdquo;、&amp;ldquo;1/1s&amp;rdquo;&lt;/li>
&lt;/ul>
&lt;p>具体示例如下所示：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">$ hrp boom testcase.yml --spawn-count &lt;span style="color:#0000cf;font-weight:bold">100&lt;/span> --spawn-rate &lt;span style="color:#0000cf;font-weight:bold">100&lt;/span> --max-rps &lt;span style="color:#0000cf;font-weight:bold">1000&lt;/span> --request-increase-rate &lt;span style="color:#0000cf;font-weight:bold">100&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>在该示例中，我们指定了 100 并发用户，按照每秒 100 个的速率初始化用户，预计在 1s 后可完成初始化。同时，我们限制在整个压测过程中，hrp 最高只能发压 1000 RPS，同时限定每秒增加的速率为 100 RPS。&lt;/p>
&lt;p>如果你对这块儿感到比较懵，没有关系，你暂时只需要知道这里使用了「令牌桶」的算法对发压流量实现了限流处理。后面我们会专门写一篇文章详细介绍这部分的使用方法和机制原理。&lt;/p>
&lt;h3 id="设置循环次数">设置循环次数&lt;/h3>
&lt;p>除了手动控制压测时长外，HttpRunner v4.0 还支持按照指定的循环次数执行压测，可通过 &lt;code>--loop-count&lt;/code> 参数进行指定。&lt;/p>
&lt;p>需要说明的是，HttpRunner v4.0 执行循环次数的逻辑参考的是 JMeter，所有虚拟用户均会运行指定的循环次数，即当次压测的整体运行次数为：&lt;code>spawn-count * loop-count&lt;/code>。&lt;/p>
&lt;p>执行如下命令，执行完指定循环次数后，HttpRunner 将结束运行并打印整体测试数据。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">$ hrp boom testcase.yml --spawn-count &lt;span style="color:#0000cf;font-weight:bold">100&lt;/span> --spawn-rate &lt;span style="color:#0000cf;font-weight:bold">10&lt;/span> --loop-count &lt;span style="color:#0000cf;font-weight:bold">1000&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>在该示例中，我们指定了 100 个并发用户，每个用户循序运行 1000 次，预计总共运行 100*1000=10w 次。&lt;/p>
&lt;h2 id="执行性能测试">执行性能测试&lt;/h2>
&lt;p>配置好命令行参数后，即可开始执行性能测试。在性能测试过程中，我们可以通过两种方式查看到性能测试结果数据。&lt;/p>
&lt;h3 id="命令行终端">命令行终端&lt;/h3>
&lt;p>性能测试过程中，hrp 每隔 3s 会打印一次性能数据，其中汇总了 3s 内的所有请求情况。结果样式如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-text" data-lang="text">Current time: 2022/05/16 03:33:26, Users: 1000, State: running, Total RPS: 533.7, Total Average Response Time: 436.8ms, Total Fail Ratio: 0.0%
Accumulated Transactions: 16176 Passed, 3 Failed
+--------------+--------------------+------------+---------+--------+---------+------+-------+--------------+------------+-------------+
| TYPE | NAME | # REQUESTS | # FAILS | MEDIAN | AVERAGE | MIN | MAX | CONTENT SIZE | # REQS/SEC | # FAILS/SEC |
+--------------+--------------------+------------+---------+--------+---------+------+-------+--------------+------------+-------------+
| request-GET | get with params | 799 | 0 | 320 | 432.20 | 273 | 1854 | 266 | 266.33 | 0.00 |
| request-POST | post with params | 156 | 0 | 280 | 388.44 | 272 | 3633 | 358 | 52.00 | 0.00 |
| request-POST | post with params 2 | 799 | 1 | 400 | 594.02 | 275 | 30000 | 357 | 266.33 | 0.33 |
| transaction | tran1 | 799 | 0 | 320 | 432.37 | 273 | 1854 | 0 | 266.33 | 0.00 |
| transaction | Action | 799 | 1 | 4100 | 4939.17 | 3198 | 35450 | 0 | 266.33 | 0.33 |
+--------------+--------------------+------------+---------+--------+---------+------+-------+--------------+------------+-------------+
&lt;/code>&lt;/pre>&lt;/div>&lt;p>针对打印的指标说明如下：&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:center">指标名称&lt;/th>
&lt;th style="text-align:center">指标说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:center">Users&lt;/td>
&lt;td style="text-align:center">当前虚拟用户数&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">State&lt;/td>
&lt;td style="text-align:center">HttpRunner当前运行状态&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Total RPS&lt;/td>
&lt;td style="text-align:center">总RPS&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Total Response&lt;/td>
&lt;td style="text-align:center">总响应时间&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Total Fail Ratio&lt;/td>
&lt;td style="text-align:center">总请求错误率&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Accumulated Transactions&lt;/td>
&lt;td style="text-align:center">事务总通过/失败数，包含Action事务&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">TYPE&lt;/td>
&lt;td style="text-align:center">请求类型&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">NAME&lt;/td>
&lt;td style="text-align:center">请求名称&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">REQUESTS&lt;/td>
&lt;td style="text-align:center">请求数&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">FAILS&lt;/td>
&lt;td style="text-align:center">请求失败数&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">MEDIAN&lt;/td>
&lt;td style="text-align:center">响应时间中位数&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">AVERAGE&lt;/td>
&lt;td style="text-align:center">响应时间平均值&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">MIN&lt;/td>
&lt;td style="text-align:center">响应时间最小值&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">MAX&lt;/td>
&lt;td style="text-align:center">响应时间最大值&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">CONTENT SIZE&lt;/td>
&lt;td style="text-align:center">响应内容大小&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">REQS/SEC&lt;/td>
&lt;td style="text-align:center">每秒请求数&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">FAILS/SEC&lt;/td>
&lt;td style="text-align:center">每秒请求失败数&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>注：表格内皆为统计间隔(3s)内的性能指标数据&lt;/p>
&lt;p>完成性能测试时，会打印整体测试数据，结果样式如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-text" data-lang="text">=========================================== Statistics Summary ==========================================
Current time: 2022/05/16 03:33:38, Users: 1000, Duration: 57s, Accumulated Transactions: 20947 Passed, 3 Failed
+-------+------------+---------+--------+---------+-----+-------+--------------+------------+-------------+
| NAME | # REQUESTS | # FAILS | MEDIAN | AVERAGE | MIN | MAX | CONTENT SIZE | # REQS/SEC | # FAILS/SEC |
+-------+------------+---------+--------+---------+-----+-------+--------------+------------+-------------+
| Total | 31182 | 2 | 300 | 436.70 | 268 | 30003 | 325 | 547.05 | 0.04 |
+-------+------------+---------+--------+---------+-----+-------+--------------+------------+-------------+
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Statistics Summary&lt;/code> 展示的是性能测试整个过程中的总体指标数据；指标说明与上面表格一致，只额外增加了一个指标。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:center">指标名称&lt;/th>
&lt;th style="text-align:center">指标说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:center">Duration&lt;/td>
&lt;td style="text-align:center">测试持续时间&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="查看性能监控">查看性能监控&lt;/h3>
&lt;p>除了在终端中查看性能测试过程和结果汇总数据之外，我们还可以通过配置 Prometheus + Grafana 看板，实现 Web 化的实时监控指标展示。&lt;/p>
&lt;p>效果如下所示：&lt;/p>
&lt;p>&lt;img src="https://httprunner.com/image/demo-grafana.png" alt="">&lt;/p>
&lt;p>限于篇幅，关于 Prometheus + Grafana 的性能监控配置方面的内容，将在下一篇文章《如何使用 HttpRunner v4.0 开展性能监控》中详细进行介绍。&lt;/p>
&lt;h2 id="结语">结语&lt;/h2>
&lt;p>通过以上示例，我们使用 HttpRunner v4.0 完成了一次性能测试操作实践，相信大家应该对 HttpRunner v4.0 的性能测试使用方法有了一个整体的认识。&lt;/p>
&lt;p>欢迎大家多多实践，如果在使用过程中遇到任何问题，欢迎通过各种渠道进行反馈，我们将及时进行跟进和解答，并基于大家的反馈进行迭代优化。&lt;/p>
&lt;p>接下来，我们将连载介绍 HttpRunner v4.0 的更多性能测试功能特性，敬请期待。&lt;/p>
&lt;blockquote>
&lt;p>本文作者：&lt;a href="https://github.com/xucong053">xucong053&lt;/a>，HttpRunner 核心开发者，重点建设了性能测试相关能力&lt;br/>
HttpRunner 项目官网: &lt;a href="https://httprunner.com/">https://httprunner.com/&lt;/a>&lt;br/>
如果 HttpRunner 对你有过帮助，麻烦帮忙给个 ⭐️star⭐️ 鼓励下吧&lt;br/>
&lt;a href="https://github.com/httprunner/httprunner">https://github.com/httprunner/httprunner&lt;/a>&lt;/p>
&lt;/blockquote></description></item><item><title>Blog: 使用 HttpRunner v4.0 实现 WebSocket 的测试</title><link>https://httprunner.com/blog/how-to-test-websocket/</link><pubDate>Fri, 13 May 2022 00:00:00 +0000</pubDate><guid>https://httprunner.com/blog/how-to-test-websocket/</guid><description>
&lt;p>HttpRunner 从 v4.0 开始新增支持 WebSocket 协议。&lt;/p>
&lt;p>本文将结合案例初步介绍使用 HttpRunner v4.0 测试 WebSocket 的方法，欢迎大家多多实践，后续我们将基于大家的反馈进行迭代优化。&lt;/p>
&lt;h2 id="功能概览">功能概览&lt;/h2>
&lt;p>在 HttpRunner v4.0 中，当前针对 WebSocket 支持了如下能力：&lt;/p>
&lt;ul>
&lt;li>提供了 6 种不同的 WebSocket 操作类型，覆盖了 Websocket 接口/性能测试的常见使用场景&lt;/li>
&lt;li>建立连接阶段支持设置请求参数和请求头&lt;/li>
&lt;li>支持发送文本/二进制两种类型的消息，支持从本地文件导入的方式来加载二进制消息&lt;/li>
&lt;li>发送 ping 和 close 控制消息时，同样支持发送文本/二进制消息&lt;/li>
&lt;li>通知 close 操作通知服务端断开当前连接之前，会自动丢弃现有连接中的冗余消息&lt;/li>
&lt;li>支持设置代理 URL&lt;/li>
&lt;li>继承了 HttpRunner 强大的参数关联和结果断言能力&lt;/li>
&lt;/ul>
&lt;h2 id="案例演示">案例演示&lt;/h2>
&lt;p>实践出真知，首先我们来看一个完整的测试用例。&lt;/p>
&lt;p>该测试用例使用的被测服务是一个类似于 httpbin 的回显服务，协议类型是 WebSocket 协议：&lt;code>ws://echo.websocket.events&lt;/code>。无论客户端发送了什么消息，服务端都会原封不动地返回，具体效果可以参考&lt;a href="https://echo.websocket.events/.ws">链接&lt;/a>。&lt;/p>
&lt;p>测试用例总共包含了如下的 10 个步骤：&lt;/p>
&lt;ol>
&lt;li>建立一个新的连接并携带请求头 &amp;ldquo;User-Agent&amp;rdquo;: &amp;ldquo;HttpRunnerPlus&amp;rdquo;，并且对响应状态码 &lt;code>status_code&lt;/code> 和响应头 &lt;code>headers.Connection&lt;/code> 的内容进行断言&lt;/li>
&lt;li>进行一次 ping pong 连接测试，超时时间设为 5 秒&lt;/li>
&lt;li>读取建立连接之后，服务端主动推送的赞助消息 &amp;ldquo;echo.websocket.events sponsored by Lob.com&amp;rdquo;，并对 &lt;code>body&lt;/code> 中包含的字符串内容进行断言，超时时间设为 5 秒&lt;/li>
&lt;li>写消息，指定消息类型为文本类型，消息内容为 JSON 格式：&lt;code>{&amp;quot;foo1&amp;quot;: &amp;quot;${gen_random_string($n)}&amp;quot;, &amp;quot;foo2&amp;quot;: &amp;quot;${max($a, $b)}&amp;quot;}&lt;/code>，注意该消息内容中用到了 HttpRunner 的内置函数 &lt;code>gen_random_string&lt;/code> 和 &lt;code>max&lt;/code>&lt;/li>
&lt;li>读消息，不需要指定消息类型，对 body.foo1 进行参数提取，保存为新的变量 &lt;code>varFoo1&lt;/code>，随后再对 &lt;code>body.foo1&lt;/code> 的长度和 &lt;code>body.foo2&lt;/code> 的值进行断言&lt;/li>
&lt;li>读写消息，写消息的类型为文本类型，消息内容为上一步中提取的 &lt;code>varFoo1&lt;/code>，并对服务端返回的消息进行读取，并且对 body 的长度进行断言&lt;/li>
&lt;li>读写消息，写消息的类型为二进制类型，消息内容为从本地文件导入的二进制数据，并对服务端返回的消息进行读取，但不进行任何参数提取和结果断言操作&lt;/li>
&lt;li>写一段冗余的消息 &amp;ldquo;have a nice day!&amp;quot;，用于测试断开连接前冗余消息的自动舍弃&lt;/li>
&lt;li>写一段冗余的消息 &amp;ldquo;balabala &amp;hellip;&amp;quot;，用于测试断开连接前冗余消息的自动舍弃&lt;/li>
&lt;li>通知服务端断开当前连接，超时时间设为 30 秒，指定状态码为 1000（说明客户端是正常断开连接），并且对服务端返回的响应状态码进行断言&lt;/li>
&lt;/ol>
&lt;p>上述测试用例对应的脚本形式如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#204a87;font-weight:bold">config&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">run request with WebSocket protocol&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">base_url&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">ws://echo.websocket.events&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">variables&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">a&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">12.3&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">b&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">3.45&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">file&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;./demo_file_load_ws_message.txt&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">n&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">5&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">teststeps&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">open connection&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">websocket&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">open&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">url&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">headers&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">User-Agent&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">HttpRunnerPlus&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">validate&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">check&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">status_code&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">assert&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">equals&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">expect&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">101&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">msg&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">check open status code&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">check&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">headers.Connection&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">assert&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">equals&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">expect&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Upgrade&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">msg&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">check headers&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">ping pong test&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">websocket&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">ping&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">url&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">timeout&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">5000&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">read sponsor info&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">websocket&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">url&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">timeout&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">5000&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">validate&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">check&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">body&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">assert&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">contains&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">expect&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Lob.com&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">msg&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">check sponsor message&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">write json&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">websocket&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">w&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">url&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">text&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">foo1&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;${gen_random_string($n)}&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">foo2&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;${max($a, $b)}&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">read json&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">websocket&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">url&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">extract&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">varFoo1&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">body.foo1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">validate&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">check&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">body.foo1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">assert&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">length_equals&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">expect&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">5&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">msg&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">check json foo1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">check&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">body.foo2&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">assert&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">equals&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">expect&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">12.3&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">msg&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">check json foo2&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">write and read text&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">websocket&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">wr&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">url&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">text&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;$varFoo1&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">validate&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">check&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">body&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">assert&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">length_equals&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">expect&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">5&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">msg&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">check length equal&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">write and read binary file&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">websocket&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">wr&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">url&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">binary&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;${load_ws_message($file)}&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">write something redundant&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">websocket&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">w&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">url&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">text&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">have a nice day!&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">write something redundant&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">websocket&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">w&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">url&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">text&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">balabala ...&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">close connection&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">websocket&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">close&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">url&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">close_status&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1000&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">timeout&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">30000&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">validate&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">check&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">status_code&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">assert&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">equals&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">expect&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1000&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">msg&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">check close status code&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>需要说明的是，该测试用例中的示例文件需要由用户自己来指定，文件路径填写有效的绝对路径或相对路径即可，这里的示例文件 &lt;code>demo_file_load_ws_message.txt&lt;/code> 只是以 txt 文件为例，实际上该文件可以为任意类型，最终导入之后都为二进制类型。&lt;/p>
&lt;p>除了 YAML/JSON 格式外，我们也可以采用 gotest 的方式编写用例，形式如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#204a87;font-weight:bold">package&lt;/span> &lt;span style="color:#000">tests&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">import&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;testing&amp;#34;&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;github.com/httprunner/httprunner/v4/hrp&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000">TestWebSocketProtocol&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">t&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">testing&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">T&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">testcase&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">TestCase&lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">Config&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewConfig&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;run request with WebSocket protocol&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">SetBaseURL&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;ws://echo.websocket.events&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WithVariables&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">map&lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#204a87;font-weight:bold">string&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>&lt;span style="color:#204a87;font-weight:bold">interface&lt;/span>&lt;span style="color:#000;font-weight:bold">{}{&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;n&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">5&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;a&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">12.3&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;b&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">3.45&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;file&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;./demo_file_load_ws_message.txt&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">}),&lt;/span>
&lt;span style="color:#000">TestSteps&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[]&lt;/span>&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">IStep&lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewStep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;open connection&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WebSocket&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">OpenConnection&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WithHeaders&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">map&lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#204a87;font-weight:bold">string&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>&lt;span style="color:#204a87;font-weight:bold">string&lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;User-Agent&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;HttpRunnerPlus&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">}).&lt;/span>
&lt;span style="color:#000">Validate&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">AssertEqual&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;status_code&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">101&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;check open status code&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">AssertEqual&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;headers.Connection&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Upgrade&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;check headers&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewStep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;ping pong test&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WebSocket&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">PingPong&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WithTimeout&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">5000&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewStep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;read sponsor info&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WebSocket&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">Read&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WithTimeout&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">5000&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">Validate&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">AssertContains&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;body&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Lob.com&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;check sponsor message&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewStep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;write json&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WebSocket&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">Write&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WithTextMessage&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">map&lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#204a87;font-weight:bold">string&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>&lt;span style="color:#204a87;font-weight:bold">interface&lt;/span>&lt;span style="color:#000;font-weight:bold">{}{&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;foo1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;${gen_random_string($n)}&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;foo2&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;${max($a, $b)}&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">}),&lt;/span>
&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewStep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;read json&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WebSocket&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">Read&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">Extract&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">WithJmesPath&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;body.foo1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;varFoo1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">Validate&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">AssertLengthEqual&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;body.foo1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">5&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;check json foo1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">AssertEqual&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;body.foo2&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">12.3&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;check json foo2&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewStep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;write and read text&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WebSocket&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">WriteAndRead&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WithTextMessage&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;$varFoo1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">Validate&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">AssertLengthEqual&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;body&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">5&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;check length equal&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewStep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;write and read binary file&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WebSocket&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">WriteAndRead&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WithBinaryMessage&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;${load_ws_message($file)}&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewStep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;write something redundant&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WebSocket&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">Write&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WithTextMessage&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;have a nice day!&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewStep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;write something redundant&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WebSocket&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">Write&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WithTextMessage&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;balabala ...&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewStep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;close connection&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WebSocket&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">CloseConnection&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WithTimeout&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">30000&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WithCloseStatus&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1000&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">Validate&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">AssertEqual&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;status_code&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1000&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;check close status code&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// run testcase
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000">err&lt;/span> &lt;span style="color:#000;font-weight:bold">=&lt;/span> &lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewRunner&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">t&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">Run&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">testcase&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000">err&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">!=&lt;/span> &lt;span style="color:#204a87;font-weight:bold">nil&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">t&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Fatalf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;run testcase error: %v&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">err&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>可以看出，WebSocket 协议的脚本形式与之前 HTTP(S) 协议的格式基本一致。如果大家使用 gotest 编写脚本，也可以借助「链式调用」获得方法提示。&lt;/p>
&lt;h2 id="操作类型介绍">操作类型介绍&lt;/h2>
&lt;p>WebSocket 不同于 HTTP 协议，不再使用 GET/POST/PUT/etc. 请求方法，而是包含 &lt;code>open/close/ping/w/r/wr&lt;/code> 6 种操作类型。&lt;/p>
&lt;p>下面对这 6 种操作类型进行介绍：&lt;/p>
&lt;ul>
&lt;li>open：创建一个新的 WebSocket 连接，创建连接是进行通信的第一步，如果在进行后续操作之前不先创建连接，则执行时会因为当前无可用连接而报错。WebSocket 的全双工连接最初是客户端发起 HTTP 请求，并进行协议升级而得来的，所以在建立连接的阶段是可以像常规的 HTTP 请求一样设置请求参数和请求头的，HttpRunner 支持在创建连接阶段设置请求参数和请求头，从而可以满足更加灵活的测试场景。需要注意的是，进行协议升级时的请求方法只限于 GET 方法，如果为 POST 方法，则请求会被 HTTP 服务而不是 WebSocket 服务处理。open 操作除了支持设置请求参数和请求头之外，还支持设置超时时间，这里的超时时间可以理解为是握手阶段的超时时间&lt;/li>
&lt;li>ping：客户端发送一个 ping 控制消息，并且期待服务端返回的 pong 控制消息。WebSocket 建立的连接会占用客户端和服务端双方的网络资源，因此服务端一般会在无新操作之后的一段时间自动关闭当前连接，例如上面例子中用到的 echo.websocket.events 服务就会在双方无操作 60 秒之后自动关闭连接。如果客户端希望保持当前连接处于不断开的状态，又不希望发送具体的文本/二进制消息，则可以定时发送一个 ping 控制消息来维持当前连接，服务端会在收到 ping 控制消息之后向客户端回传一个 pong 控制消息，客户端接受到 pong 控制消息则可以确认服务端会继续保持当前连接的状态。上述的过程又称为 WebSocket 心跳机制，HttpRunner 支持在 ping 操作的同时发送文本/二进制消息，同时接收 pong 的过程是异步进行的，不会阻塞后续步骤的进行的，然而也正是由于接收 pong 的过程是异步进行的，暂不支持对服务端的 pong 响应进行参数提取和结果断言&lt;/li>
&lt;li>w：客户端尝试向服务端进行一次写消息，适用于性能测试中单独测试上行通信的场景，该操作暂不支持设置超时时间。写消息的内容可以为文本/二进制消息，如果为二进制消息则可以通过 HttpRunner 的内置函数 &lt;code>load_ws_message&lt;/code> 来导入消息内容。由于写消息的过程是客户端向服务端的单向通信过程，不存在接收响应的过程，因此也不支持响应的参数提取和结果断言&lt;/li>
&lt;li>r：客户端尝试对服务端发来的消息进行一次读取，适用于性能测试中单独测试下行通信的场景，需要注意读取消息的内容仅限于文本/二进制消息，控制消息是在 ping / close 操作中单独来接收和处理的&lt;/li>
&lt;li>wr：进行一次消息读写，可以理解为是 w 和 r 两个操作的顺序组合，其过程类似于 HTTP 协议中发送请求和接收响应的过程，是 WebSocket 接口测试中较为常见的一类操作&lt;/li>
&lt;li>close：通知服务端断开当前的 WebSocket 连接，并且在断开前，当前连接中的冗余消息会被舍弃。与 ping 操作类似，在发送 close 控制消息的同时也支持发送文本/二进制消息，此外还支持指定断开连接的状态码，该状态码可以用于说明断开连接的原因，不同状态码的含义可以参考 &lt;a href="https://www.rfc-editor.org/rfc/rfc6455.html#section-11.7">RFC 6455&lt;/a> 中的详细介绍&lt;/li>
&lt;/ul>
&lt;p>需要注意的是，6 种操作类型会存在一些限制差异，可查看如下对比表格：&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:center">操作类型&lt;/th>
&lt;th style="text-align:center">open&lt;/th>
&lt;th style="text-align:center">ping&lt;/th>
&lt;th style="text-align:center">w&lt;/th>
&lt;th style="text-align:center">r&lt;/th>
&lt;th style="text-align:center">wr&lt;/th>
&lt;th style="text-align:center">close&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:center">支持设置超时时间&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">支持设置请求参数和请求头&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">是否为阻塞操作&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">支持发送消息&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">支持设置状态码&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">支持参数提取和结果断言&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="注意事项">注意事项&lt;/h2>
&lt;p>另外，在测试 WebSocket 协议的时候还需注意如下事项：&lt;/p>
&lt;ul>
&lt;li>在参数未填写或者非法的情况下，所有操作的超时时间默认为 30 秒，close 操作的状态码默认为 1000（正常断开）&lt;/li>
&lt;li>不同类型的 WebSocket 操作支持的参数提取和结果断言的对象类型也是不同的：
&lt;ul>
&lt;li>open 操作支持的参数提取和结果断言的对象类型与 HTTP 协议支持的相同，包括 proto、status_code、headers、cookies 和 body&lt;/li>
&lt;li>r 和 wr 操作支持的参数提取和结果断言的对象类型只有 body&lt;/li>
&lt;li>close 操作支持的参数提取和结果断言的对象类型包括 status_code 和 body，并且 body 的类型一定为字符串&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>发送二进制消息时，建议使用内置函数 &lt;code>load_ws_message&lt;/code> 从本地文件导入的方式来加载二进制消息，因为通过 JSON/YAML 脚本的方式无法直接指定二进制消息的内容（采用 go test 的方式来编写测试用例时，也可以通过 &lt;code>bytes.Buffer&lt;/code> 的方式来指定二进制消息内容）&lt;/li>
&lt;li>如果测试用例的最后一步没有指定 close 操作，当前会话结束时也会自动断开当前连接，但是断开前不会丢弃当前连接中的冗余消息，也不会通知服务端断开连接，而是从客户端直接断开连接。&lt;/li>
&lt;/ul>
&lt;h2 id="whats-next">What&amp;rsquo;s next&lt;/h2>
&lt;ul>
&lt;li>目前 hrp har2case 命令还不支持将包含 WebSocket 请求的 har 包转换为 JSON/YAML 测试用例，HttpRunner v4.0 之后的版本中将会对该特性进行支持&lt;/li>
&lt;li>目前暂不支持自动重连机制，之后版本将支持在服务端主动断开连接后进行自动重连，并支持指定自动重连的间隔时间和最大重试次数&lt;/li>
&lt;li>目前二进制消息会转为字符串或者程序内部变量的形式来进行参数提取和结果断言的，后续计划支持二进制消息的单独参数提取和结果断言机制&lt;/li>
&lt;li>单独维护一个 WebSocket 消息缓冲区，将 ping 操作的执行过程由异步调整为同步，从而可以对 pong 响应的结果进行参数提取和断言&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>本文作者：卜卜星，HttpRunner 核心开发者，贡献了本文介绍的 WebSocket 协议测试能力&lt;br/>
HttpRunner 项目官网: &lt;a href="https://httprunner.com/">https://httprunner.com/&lt;/a>&lt;br/>
如果 HttpRunner 对你有过帮助，麻烦帮忙给个 ⭐️star⭐️ 鼓励下吧&lt;br/>
&lt;a href="https://github.com/httprunner/httprunner">https://github.com/httprunner/httprunner&lt;/a>&lt;/p>
&lt;/blockquote></description></item><item><title>Blog: 使用 HttpRunner v4.0 实现 HTTP/2 的测试</title><link>https://httprunner.com/blog/how-to-test-http2/</link><pubDate>Thu, 12 May 2022 00:00:00 +0000</pubDate><guid>https://httprunner.com/blog/how-to-test-http2/</guid><description>
&lt;h2 id="前言回顾">前言回顾&lt;/h2>
&lt;p>此前的文章 &lt;a href="https://httprunner.com/blog/release-v4/">HttpRunner v4.0 正式发布&lt;/a> 中提到，HttpRunner v4.0 已不再局限于 HTTP 协议，而是会拓展支持更多种类的网络协议，截至当前，HttpRunner v4.0 中 go 引擎已经新增支持了 HTTP/2 协议 和 WebSocket 协议，python 引擎也已经新增支持了 SQL 操作和 Thrift RPC 协议。本期文章将对支持 HTTP/2 的新特性进行介绍，对于 HttpRunner v4.0 的其他新特性，之后也将会陆续进行介绍，敬请期待。&lt;/p>
&lt;h2 id="特性介绍">特性介绍&lt;/h2>
&lt;p>对于原有的包含 HTTP/1.1 请求的测试脚本，将协议类型升级为 HTTP/2 的修改成本非常低，在添加请求参数、请求头和请求体等操作方面，HTTP/2 的测试用例与 HTTP/1.1 的风格基本保持一致，同时也继承了 HttpRunner 强大的参数关联和结果断言等功能。下面介绍将测试用例中的协议类型由 HTTP/1.1 升级为 HTTP/2 的具体修改方式。&lt;/p>
&lt;h3 id="jsonyaml-形态的测试用例">JSON/YAML 形态的测试用例&lt;/h3>
&lt;p>对于 JSON/YAML 形态的测试用例，只需要在 &lt;code>request&lt;/code> 对象中添加一个新字段 &lt;code>http2&lt;/code> 并且指定为 &lt;code>true&lt;/code>。另外，新版本 HttpRunner 也支持对协议类型的断言（&amp;ldquo;check&amp;rdquo;: &amp;ldquo;proto&amp;rdquo;），这对于判断服务端是否支持 HTTP/2 的场景来说是非常实用的，因为有些时候服务端不支持 HTTP/2 并且会自动降级为 HTTP/1.1，这时就有必要对协议类型进行断言。如下是一个 HTTP 协议升级之后的 JSON 测试用例，在原来的基础上，只增加了一行代码 &lt;code>&amp;quot;http2&amp;quot;: true&lt;/code> 即可将 HTTP/1.1 升级为 HTTP/2，YAML 脚本同理，此处不再赘述。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;config&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;run request with HTTP/2&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;base_url&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;https://postman-echo.com&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;teststeps&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;HTTP/2 get&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;request&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;method&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;GET&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;url&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;/get&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;http2&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;params&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;foo1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;foo1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;foo2&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;foo2&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;headers&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;User-Agent&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;HttpRunnerPlus&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;validate&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;check&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;status_code&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;assert&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;equals&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;expect&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">200&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;msg&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;check status code&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;check&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;proto&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;assert&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;equals&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;expect&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;HTTP/2.0&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;msg&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;check protocol type&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;check&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;body.args.foo1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;assert&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;length_equals&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;expect&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;msg&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;check param foo1&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="go-test-形态的测试用例">go test 形态的测试用例&lt;/h3>
&lt;p>对于 go test 形态的测试用例，将 HTTP/1.1 升级为 HTTP/2 的方式同样非常简单，只需要在调用链中的 GET、POST 等请求方法之前先调用 HTTP2() 即可。如下是一个 HTTP 协议升级之后的 go test 测试用例，请注意 hrp.NewStep 方法与 GET、POST 请求方法之间新增的 HTTP2() 调用。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#204a87;font-weight:bold">package&lt;/span> &lt;span style="color:#000">tests&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">import&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;testing&amp;#34;&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;github.com/httprunner/httprunner/hrp&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">func&lt;/span> &lt;span style="color:#000">TestHTTPProtocol&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">t&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">testing&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">T&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">testcase&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">TestCase&lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">Config&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewConfig&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;run request with HTTP/1.1 and HTTP/2&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">SetBaseURL&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;https://postman-echo.com&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000">TestSteps&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[]&lt;/span>&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">IStep&lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewStep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;HTTP/2 get&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">HTTP2&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">GET&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/get&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WithParams&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">map&lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#204a87;font-weight:bold">string&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>&lt;span style="color:#204a87;font-weight:bold">interface&lt;/span>&lt;span style="color:#000;font-weight:bold">{}{&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;foo1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;foo1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;foo2&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;foo2&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">}).&lt;/span>
&lt;span style="color:#000">WithHeaders&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">map&lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#204a87;font-weight:bold">string&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>&lt;span style="color:#204a87;font-weight:bold">string&lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;User-Agent&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;HttpRunnerPlus&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">}).&lt;/span>
&lt;span style="color:#000">Validate&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">AssertEqual&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;status_code&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">200&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;check status code&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">AssertEqual&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;proto&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;HTTP/2.0&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;check protocol type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">AssertLengthEqual&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;body.args.foo1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;check param foo1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewStep&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;HTTP/2 post&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">HTTP2&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">POST&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/post&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">WithHeaders&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">map&lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#204a87;font-weight:bold">string&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>&lt;span style="color:#204a87;font-weight:bold">string&lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;User-Agent&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;HttpRunnerPlus&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">}).&lt;/span>
&lt;span style="color:#000">WithBody&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">map&lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#204a87;font-weight:bold">string&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>&lt;span style="color:#204a87;font-weight:bold">interface&lt;/span>&lt;span style="color:#000;font-weight:bold">{}{&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;foo1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;foo1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;foo2&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;foo2&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">}).&lt;/span>
&lt;span style="color:#000">Validate&lt;/span>&lt;span style="color:#000;font-weight:bold">().&lt;/span>
&lt;span style="color:#000">AssertEqual&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;status_code&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">200&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;check status code&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">AssertEqual&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;proto&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;HTTP/2.0&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;check protocol type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>
&lt;span style="color:#000">AssertLengthEqual&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;body.json.foo1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;check body foo1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000">err&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#000">hrp&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">NewRunner&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">t&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">Run&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">testcase&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000">err&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">!=&lt;/span> &lt;span style="color:#204a87;font-weight:bold">nil&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">t&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">Fatalf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;run testcase error: %v&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">err&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="注意事项">注意事项&lt;/h2>
&lt;ul>
&lt;li>在使用 &lt;code>hrp run&lt;/code> 进行接口测试时，通过命令行选项 &lt;code>--proxy-url&lt;/code> 设置的代理 URL 对于 HTTP/2 协议的请求不会生效，原因是底层依赖不支持设置代理 URL&lt;/li>
&lt;li>在使用 &lt;code>hrp boom&lt;/code> 进行性能测试时，通过命令行选项 &lt;code>--disable-keepalive&lt;/code> 设置的打开/关闭长连接对于 HTTP/2 协议的请求不会生效，原因是底层依赖不支持设置改参数，另外 HTTP/2 协议支持多路复用，可以天然地达到类似长连接的效果&lt;/li>
&lt;li>虽然 RFC 文档中没有强制规定，不过目前大部分 HTTP/2 服务是建立在 SSL/TLS 之上的，因此建议在 URL 中使用 HTTPS&lt;/li>
&lt;/ul>
&lt;h2 id="whats-next">What&amp;rsquo;s next&lt;/h2>
&lt;p>目前 &lt;code>hrp har2case&lt;/code> 命令还不支持将包含 HTTP/2 请求的 har 包转换为 JSON/YAML 测试用例，HttpRunner v4.0 之后的版本中将会对该特性进行支持&lt;/p>
&lt;blockquote>
&lt;p>本文作者：卜卜星（HttpRunner 核心开发者）&lt;br/>
HttpRunner 项目官网: &lt;a href="https://httprunner.com/">https://httprunner.com/&lt;/a>&lt;br/>
如果 HttpRunner 对你有过帮助，麻烦帮忙给个 ⭐️star⭐️ 鼓励下吧&lt;br/>
&lt;a href="https://github.com/httprunner/httprunner">https://github.com/httprunner/httprunner&lt;/a>&lt;/p>
&lt;/blockquote></description></item><item><title>Blog: HttpRunner v4.0 用户文档 &amp; 博客规划</title><link>https://httprunner.com/blog/docs-plan/</link><pubDate>Wed, 11 May 2022 00:00:00 +0000</pubDate><guid>https://httprunner.com/blog/docs-plan/</guid><description>
&lt;p>终于，被大家吐槽最多的 HttpRunner 文档问题要解决啦！！！&lt;/p>
&lt;p>在 HttpRunner v4.0 &lt;a href="https://httprunner.com/blog/release-v4/#%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3">发布介绍&lt;/a>中有提到，用户文档会作为 HttpRunner 开源项目运营的重点工作，本文就具体介绍下后续关于 HttpRunner 用户文档和博客文章的规划。&lt;/p>
&lt;h2 id="用户文档">用户文档&lt;/h2>
&lt;p>首先是用户使用文档部分。这部分对应 HttpRunner 的使用手册，可以帮助用户快速整体了解 HttpRunner，并且作为用户在实际使用过程中的参考指引。&lt;/p>
&lt;p>基于该定位，用户文档会写得非常详尽，覆盖 HttpRunner 的所有功能和使用细节。&lt;/p>
&lt;p>当前阶段，我们已经完成了对 HttpRunner v4.0 用户文档的大纲规划和部分内容的编写，整体预计在 5 月底完成所有内容。&lt;/p>
&lt;p>大家可以通过如下地址进行查看：&lt;/p>
&lt;p>&lt;strong>HttpRunner 用户文档永久地址&lt;/strong>: &lt;a href="https://httprunner.com/docs/">https://httprunner.com/docs/&lt;/a>&lt;/p>
&lt;p>如果你发现当前大纲中有遗漏的内容，非常欢迎通过各种渠道及时反馈给我们。&lt;/p>
&lt;h2 id="博客文章">博客文章&lt;/h2>
&lt;p>除了用户使用文档，我们还会&lt;strong>高频&lt;/strong>推送一些博客文章，期待能跟大家有更多的交流互动。&lt;/p>
&lt;p>博客文章计划分为 4 类主题：&lt;/p>
&lt;ul>
&lt;li>特性发布：针对重要功能特性进行介绍，帮助用户及时获知 HttpRunner 项目动态&lt;/li>
&lt;li>案例实践：基于真实案例场景，演示工具的主要功能特性和使用方法，帮助用户更快地上手使用 HttpRunner&lt;/li>
&lt;li>工具比对：与主流 API 测试工具在功能和性能层面进行全方位对比，帮助用户更全面地了解 HttpRunner&lt;/li>
&lt;li>原理解析：深入介绍 HttpRunner 的底层机制和原理，帮助用户彻底掌握 HttpRunner 的设计和实现&lt;/li>
&lt;/ul>
&lt;p>在内容渠道方面，大家可以通过如下 3 种途径进行阅读：&lt;/p>
&lt;ul>
&lt;li>HttpRunner 项目官网博客: &lt;a href="https://httprunner.com/blog/">https://httprunner.com/blog/&lt;/a>&lt;/li>
&lt;li>TesterHome 社区: &lt;a href="https://testerhome.com/httprunner">https://testerhome.com/httprunner&lt;/a>&lt;/li>
&lt;li>HttpRunner 微信公众号（欢迎关注，第一时间获得最新资讯）&lt;/li>
&lt;/ul>
&lt;img src="https://httprunner.com/image/qrcode.png" alt="HttpRunner" width="400">
&lt;h2 id="进度查阅">进度查阅&lt;/h2>
&lt;p>说了这么多，那后续的项目文档和博客文章的具体发布计划是什么？如何获知最新动态呢？&lt;/p>
&lt;p>为了帮助大家更好地查阅进度（监工），我们特地将 HttpRunner 核心开发者内部协作的飞书文档对外开放了权限，大家可以随时通过该文档了解我们的进展。&lt;/p>
&lt;p>&lt;a href="https://bytedance.feishu.cn/docx/doxcnD4iKnIyGoH2IOUbFcM3hJg">https://bytedance.feishu.cn/docx/doxcnD4iKnIyGoH2IOUbFcM3hJg&lt;/a>&lt;/p>
&lt;p>还是那句话，如果你发现你期望了解的内容没有出现在计划清单中，或者排期比较靠后，非常欢迎通过各种渠道及时反馈给我们。&lt;/p>
&lt;blockquote>
&lt;p>开源不易，要是 HttpRunner 对你有过帮助，麻烦帮忙给个 ⭐️star⭐️ 鼓励下吧。&lt;br/>
&lt;a href="https://github.com/httprunner/httprunner">https://github.com/httprunner/httprunner&lt;/a>&lt;/p>
&lt;/blockquote></description></item><item><title>Blog: HttpRunner v4.0 全新发布</title><link>https://httprunner.com/blog/release-v4/</link><pubDate>Tue, 26 Apr 2022 00:00:00 +0000</pubDate><guid>https://httprunner.com/blog/release-v4/</guid><description>
&lt;h2 id="v40-的诞生背景">v4.0 的诞生背景&lt;/h2>
&lt;p>HttpRunner 经过近 5 年的迭代，即将进入到 v4.0 版本了。非常欣喜的是，HttpRunner 已经有了较大的用户基数和知名度，在搜索引擎和各种主流技术社区搜索 HttpRunner 都能看到一些用户自发分享的文章，甚至还有培训班以此开设了付费课程，以及有人写书时做了较大篇幅的介绍。这些反馈给了我极大的鼓舞，让我有更大的动力将 HttpRunner 变得更好。&lt;/p>
&lt;p>那 HttpRunner v4.0 作为一个全新的大版本，诞生的背景是什么？期望达成的目标是什么呢？&lt;/p>
&lt;p>在&lt;a href="https://debugtalk.com/post/my-2021-summary/">我的 2021 年终总结&lt;/a>中有讲到，我所在的团队从去年开始重点投入到 ToB 方向。经过一段时间的探索和思考之后，我们选择以接口性能测试工具作为切入点（产品命名 &lt;code>QuickRunner&lt;/code>），并计划采用 &lt;code>Open Core&lt;/code> 的商业模式（核心能力基于开源的 HttpRunner），希望可以通过这种方式更多地触达用户收集反馈，借助开源社区打磨产品。&lt;/p>
&lt;p>不过，既有的 HttpRunner 可能还没法直接满足我们的需求。因为我们的核心目标是要做一款性能测试工具，对于发压能力和数据准确度具有非常高的要求；而之前的 HttpRunner 是基于 Python 开发的，性能测试部分使用的是 Locust，其单机发压能力和数据准确性都存在较大的问题。&lt;/p>
&lt;p>经过短暂的思考后，我打算采用 Golang 按照 HttpRunner v2 的思路重写一遍，在保持使用方式基本不变的前提下，使功能更丰富、运行更稳定、性能更强、更易部署和使用。同时，为了避免 Golang 版本在迭代初期过程中影响到已有的 Python 版本，我还新建了一个新的项目，命名为 &lt;a href="https://github.com/httprunner/hrp">HttpRunner+&lt;/a>（简称 hrp），在项目结构基本稳定后才合并到 &lt;a href="https://github.com/httprunner/httprunner">HttpRunner&lt;/a> 仓库，这也就是我们即将发布的 v4.0 版本。&lt;/p>
&lt;h2 id="v40-的核心目标">v4.0 的核心目标&lt;/h2>
&lt;p>总的来说，HttpRunner v4.0 最核心的目标是支撑 QuickRunner 成为行业领先的专业级一体化 API 测试解决方案。&lt;/p>
&lt;p>具体方面，HttpRunner v4.0 在继承 &lt;code>v2/v3&lt;/code> 已有功能和保持前向兼容的基础上，重点会在如下几个维度进行提升：&lt;/p>
&lt;ul>
&lt;li>简单易用、功能强大：这是 HttpRunner 一直以来从未改变过的目标；在保持简单易用的基础上，v4.0 会重点支持双执行引擎、多网络协议、多编程语言、多测试用途等功能&lt;/li>
&lt;li>数据精准：v4.0 致力于成为一款专业级的 API 测试工具，不管是单用户的接口请求耗时和网络性能采集，还是高并发下的性能测试指标，测试结果数据精准是底线，必须通过严格的 benchmark 测试&lt;/li>
&lt;li>海量并发：重点增强压测能力，占用资源更少，发压效率更高，单机轻松支持万级别并发压力，结合分布式稳定支撑百万级真实并发压力测试&lt;/li>
&lt;li>开源生态：充分与 API 相关工具和标准进行打通，增强数据流通性和二次开发可扩展能力&lt;/li>
&lt;/ul>
&lt;h2 id="v1v2v3v4-版本对比概览">v1/v2/v3/v4 版本对比概览&lt;/h2>
&lt;p>可能你还是会感到有些困惑，HttpRunner v4 相比于之前的 v1/v2/v3/hrp 版本，他们的关系和差异到底是什么？&lt;/p>
&lt;p>为了让你感观更加清晰，我整理出了如下表格，详细对比了各个版本间的关键差异点。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:center">版本&lt;/th>
&lt;th style="text-align:center">v1&lt;/th>
&lt;th style="text-align:center">v2&lt;/th>
&lt;th style="text-align:center">v3&lt;/th>
&lt;th style="text-align:center">HttpRunner+&lt;/th>
&lt;th style="text-align:center">v4&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:center">发布时间&lt;/td>
&lt;td style="text-align:center">2018.03.07&lt;/td>
&lt;td style="text-align:center">2019.01.01&lt;/td>
&lt;td style="text-align:center">2020.03.10&lt;/td>
&lt;td style="text-align:center">2021.11.18&lt;/td>
&lt;td style="text-align:center">2022.05.01&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">开发语言&lt;/td>
&lt;td style="text-align:center">Python&lt;/td>
&lt;td style="text-align:center">Python&lt;/td>
&lt;td style="text-align:center">Python&lt;/td>
&lt;td style="text-align:center">Golang&lt;/td>
&lt;td style="text-align:center">Golang + Python&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">版本号规范（semver）&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">网络协议&lt;/td>
&lt;td style="text-align:center">HTTP(S)/1.1&lt;/td>
&lt;td style="text-align:center">HTTP(S)/1.1&lt;/td>
&lt;td style="text-align:center">HTTP(S)/1.1&lt;/td>
&lt;td style="text-align:center">HTTP(S)/1.1&lt;/td>
&lt;td style="text-align:center">&lt;strong>多协议&lt;/strong> HTTP(S)/HTTP2/WebSocket/&lt;em>TCP/RPC&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">脚本转换工具&lt;/td>
&lt;td style="text-align:center">HAR&lt;/td>
&lt;td style="text-align:center">HAR&lt;/td>
&lt;td style="text-align:center">HAR&lt;/td>
&lt;td style="text-align:center">HAR&lt;/td>
&lt;td style="text-align:center">HAR/&lt;em>Postman/Swagger/Curl&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">工程脚⼿架&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">测试⽤例（集）格式&lt;/td>
&lt;td style="text-align:center">v1&lt;/td>
&lt;td style="text-align:center">v2&lt;/td>
&lt;td style="text-align:center">v2&lt;/td>
&lt;td style="text-align:center">v2&lt;/td>
&lt;td style="text-align:center">v2&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">测试⽤例分层机制&lt;/td>
&lt;td style="text-align:center">v1&lt;/td>
&lt;td style="text-align:center">v2&lt;/td>
&lt;td style="text-align:center">v2&lt;/td>
&lt;td style="text-align:center">v2&lt;/td>
&lt;td style="text-align:center">v2&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">脚本格式类型&lt;/td>
&lt;td style="text-align:center">YAML/JSON&lt;/td>
&lt;td style="text-align:center">YAML/JSON&lt;/td>
&lt;td style="text-align:center">YAML/JSON/&lt;strong>pytest&lt;/strong>&lt;/td>
&lt;td style="text-align:center">YAML/JSON&lt;/td>
&lt;td style="text-align:center">YAML/JSON/&lt;strong>pytest&lt;/strong>/&lt;strong>gotest&lt;/strong>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">脚本格式校验&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">&lt;a href="https://github.com/python-jsonschema/jsonschema">jsonschema&lt;/a>&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">&lt;em>TODO&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">脚本编写语法提示&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">pytest 链式调用&lt;/td>
&lt;td style="text-align:center">gotest 链式调用&lt;/td>
&lt;td style="text-align:center">gotest 链式调用 + pytest 链式调用&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">脚本执行引擎&lt;/td>
&lt;td style="text-align:center">Python unittest&lt;/td>
&lt;td style="text-align:center">Python unittest&lt;/td>
&lt;td style="text-align:center">Python &lt;strong>pytest&lt;/strong>&lt;/td>
&lt;td style="text-align:center">Go 自研&lt;/td>
&lt;td style="text-align:center">Go 自研 + Python &lt;strong>pytest&lt;/strong>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">插件化语言（debugtalk.xx）&lt;/td>
&lt;td style="text-align:center">Python&lt;/td>
&lt;td style="text-align:center">Python&lt;/td>
&lt;td style="text-align:center">Python&lt;/td>
&lt;td style="text-align:center">&lt;strong>多语言&lt;/strong>（Go/Python）&lt;/td>
&lt;td style="text-align:center">&lt;strong>多语言&lt;/strong>（Go/Python/&lt;em>Java/etc.&lt;/em>）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">参数提取机制&lt;/td>
&lt;td style="text-align:center">regex + 点分隔符&lt;/td>
&lt;td style="text-align:center">jmespath + regex + 点分隔符&lt;/td>
&lt;td style="text-align:center">jmespath&lt;/td>
&lt;td style="text-align:center">jmespath + regex&lt;/td>
&lt;td style="text-align:center">jmespath + regex&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">skip 机制&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">&lt;em>TODO&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">接口测试报告&lt;/td>
&lt;td style="text-align:center">html 自研（jinja2）&lt;/td>
&lt;td style="text-align:center">html 自研（jinja2）&lt;/td>
&lt;td style="text-align:center">pytest-html/allure&lt;/td>
&lt;td style="text-align:center">html 自研（Go template）&lt;/td>
&lt;td style="text-align:center">html 自研（Go template） + &lt;em>pytest-html/allure&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">性能测试引擎&lt;/td>
&lt;td style="text-align:center">Python Locust&lt;/td>
&lt;td style="text-align:center">Python Locust&lt;/td>
&lt;td style="text-align:center">Python Locust&lt;/td>
&lt;td style="text-align:center">Go Boomer&lt;/td>
&lt;td style="text-align:center">Go Boomer&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">运行环境依赖&lt;/td>
&lt;td style="text-align:center">Python 2.7/3.3+&lt;/td>
&lt;td style="text-align:center">Python 2.7/3.5+&lt;/td>
&lt;td style="text-align:center">Python 3.7+ pytest&lt;/td>
&lt;td style="text-align:center">无需依赖&lt;/td>
&lt;td style="text-align:center">Go 引擎无需依赖&lt;br/>pytest 引擎依赖 Python 3.7+&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">网络性能采集&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">❌&lt;/td>
&lt;td style="text-align:center">✅&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">安装部署方式&lt;/td>
&lt;td style="text-align:center">pip&lt;/td>
&lt;td style="text-align:center">pip&lt;/td>
&lt;td style="text-align:center">pip&lt;/td>
&lt;td style="text-align:center">curl/wget&lt;/td>
&lt;td style="text-align:center">curl/wget&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>注：v4 中 &lt;em>斜体&lt;/em> 代表当前还未支持，但计划会实现。&lt;/p>
&lt;p>从上面的表格可以看出，HttpRunner v4 颇有点&lt;strong>金刚葫芦娃&lt;/strong>的意思，囊括了之前所有版本的功能，并且增加了很多新特性。&lt;/p>
&lt;pre tabindex="0">&lt;code>HttpRunner v4 = v2 + v3 + hrp + ...
&lt;/code>&lt;/pre>&lt;p>在使用体验和用例格式兼容性方面，v4 也会与之前的 v2/v3/hrp 做到兼容，因此后续 HttpRunner 的维护工作都将转到 v4 版本，之前的版本将不再单独维护。&lt;/p>
&lt;h2 id="v40-核心功能介绍">v4.0 核心功能介绍&lt;/h2>
&lt;p>在 v4.0 版本中，HttpRunner 整体完成了重新设计，重点支持了双执行引擎、多网络协议、多编程语言、多测试用途等能力。&lt;/p>
&lt;p>这里先只挑选部分进行简单介绍，后续我们会补充完善的用户说明文档。&lt;/p>
&lt;h3 id="双执行引擎">双执行引擎&lt;/h3>
&lt;p>HttpRunner v4.0 可能给很多用户带来的第一直观印象，就是将项目语言替换为了 Golang。&lt;/p>
&lt;p>这种说法其实是不太准确的，确切地说，HttpRunner v4.0 同时采用了 Golang/Python 两种编程语言，底层会有两套相对独立的执行引擎，目标是兼具 Golang 的高性能和 pytest 的丰富生态。&lt;/p>
&lt;p>具体实现方面，HttpRunner v4.0 采用 Golang 基本上实现了所有的功能，除了用例执行引擎（hrp run）和压测引擎（hrp boom）外，脚手架工具（hrp startproject）、用例生成工具（hrp har2case）、脚本转换工具（hrp convert）等都优先采用 Golang 进行编写，目的是提升执行效率（毕竟是 Go）和代码质量（静态语言 &amp;amp; 类型系统）。而唯一继续采用 Python 进行编写的则是基于 Python pytest 的接口测试执行引擎（hrp pytest），主要考虑是支持 pytest 的丰富插件生态，并且与 v3 保持兼容。&lt;/p>
&lt;p>不过需要特别说明的是，使用 HttpRunner v4.0 并不是必须要具备 Go 语言基础。&lt;/p>
&lt;p>HttpRunner 的测试用例脚本支持：&lt;/p>
&lt;ul>
&lt;li>文本形态：JSON、YAML&lt;/li>
&lt;li>代码形态：pytest 和 go test&lt;/li>
&lt;/ul>
&lt;p>并且动态运算逻辑（plugin）支持多种编程语言（详见后文），包括 Python。&lt;/p>
&lt;p>因此你完全可以选择使用 JSON/YAML 格式编写维护测试用例，插件语言选择 Python，使用方式和体验可以做到基本上和 HttpRunner v2.x 一致。或者你可以选择 pytest 代码形态的脚本，在使用体验上也可以做到和 v3.x 基本一致。&lt;/p>
&lt;p>但如果你是期望使用 HttpRunner v4.0 做专业的性能测试，那么最好还是选择使用 golang 编写插件，单机发压性能（QPS）可以达到 2w 以上，这是 Python 插件远远无法达到的。&lt;/p>
&lt;h3 id="多网络协议">多网络协议&lt;/h3>
&lt;p>HttpRunner v4.0 已不再局限于 HTTP 协议，当前已成长为一个支持多协议可扩展的测试工具。&lt;/p>
&lt;p>截至当前，HttpRunner v4 已经新增支持了 HTTP/2 和 WebSocket 协议，RPC（thrift）协议正在开发中，后续将逐步支持 TCP/UDP/gRPC 等协议类型。&lt;/p>
&lt;p>不过，HttpRunner 会继续保持该命名。HTTP 作为最广泛使用的网络协议，可以作为协议的代表，就像 Postman 中的 POST 那样，也是可以讲得通的。&lt;/p>
&lt;h3 id="多编程语言">多编程语言&lt;/h3>
&lt;p>针对动态运算逻辑（plugin）部分，HttpRunner v4.0 不再局限于 Python，而是采用了 gRPC 的方案。因此理论上，&lt;a href="https://grpc.io/docs/languages/">gRPC&lt;/a> 支持 10+ 主流编程语言 HttpRunner v4 都可以支持。&lt;/p>
&lt;p>当前已支持的插件语言：&lt;/p>
&lt;ul>
&lt;li>Go&lt;/li>
&lt;li>Python&lt;/li>
&lt;li>Java（计划中，期待贡献）&lt;/li>
&lt;/ul>
&lt;p>这部分能力已经单独抽离出了一个基础组件，有兴趣可以详见 &lt;a href="https://github.com/httprunner/funplugin">httprunner/funplugin&lt;/a>。&lt;/p>
&lt;h3 id="多测试用途">多测试用途&lt;/h3>
&lt;p>HttpRunner 在创建之初就以「能力复用」为目标，期望只需编写维护一套脚本，就可以同时实现接口测试、性能测试、服务可用性监控等能力。&lt;/p>
&lt;p>在 v4.0 版本中，HttpRunner 更进一步，将新增支持「网络性能监测」，实现数字体验监测（DEM）的能力。&lt;/p>
&lt;p>同时，v4 还对 step 的类型进行了抽象，方便进行扩展。&lt;/p>
&lt;p>基于该机制，我们可以扩展支持新的网络协议类型，也可以支持新的测试类型，例如 SQL 操作或 UI 自动化。甚至我们还可以在一个测试用例中混合调用多种不同的 Step 类型，例如实现 HTTP/RPC/SQL/UI 混合场景。&lt;/p>
&lt;p>是不是很有想象力空间？&lt;/p>
&lt;h2 id="开源项目运营">开源项目运营&lt;/h2>
&lt;p>开源项目不仅仅是将代码进行公开，同时还需要建立好用户社区，帮助并引导更多的人加入进来。而在这方面 HttpRunner 一直做得都不大好，接下来必须得加强开源社区运营的投入。&lt;/p>
&lt;p>从 v4.0 版本开始，HttpRunner 期望从以下几个方面进行改进。&lt;/p>
&lt;h3 id="核心开发团队">核心开发团队&lt;/h3>
&lt;p>截至当前，HttpRunner 已经有 21 位&lt;a href="https://github.com/httprunner/httprunner/graphs/contributors">开发者&lt;/a>贡献过代码。虽然看上去还不错，但之前主要的开发维护工作基本上都还是我一个人，这对项目的健康度是非常不利的。&lt;/p>
&lt;p>庆幸的是，在 QuickRunner 项目立项之初，我们团队又投入了 2 位同学到 HttpRunner 的开发工作；同时在字节内部，其它部门另一位同样在重度使用 HttpRunner 的同学也加入了开源共建。&lt;/p>
&lt;p>因此，HttpRunner 当前有了 4 位真正意义上的核心开发者：&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/debugtalk">debugtalk&lt;/a>：负责项目的整体架构和规划；哪里有砖哪里搬&lt;/li>
&lt;li>&lt;a href="https://github.com/xucong053">xucong053&lt;/a>：贡献了多机负载分布式压测能力、Prometheus 性能数据采集能力、参数化数据驱动、html 报告等&lt;/li>
&lt;li>&lt;a href="https://github.com/bbx-winner">bbx-winner&lt;/a>：贡献了 HTTP2/WebSocket 网络协议、benchmark 数据准确性测试等&lt;/li>
&lt;li>&lt;a href="https://github.com/billduan">billduan&lt;/a>：重点投入 pytest 引擎部分，贡献了 thrift RPC 协议、集成 SQL 调用等&lt;/li>
&lt;/ul>
&lt;p>在这里也非常欢迎更多的朋友参与进来，特别是在工作中重度使用 HttpRunner 的朋友，「独行者速，众行者远」。&lt;/p>
&lt;h3 id="用户调研问卷">用户调研问卷&lt;/h3>
&lt;p>为了更好地收集 HttpRunner 用户反馈，明确需求迭代路径，我们从今年开始尝试了用户调研问卷的形式。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://wj.qq.com/s2/9699514/0d19/">HttpRunner 用户调研问卷&lt;/a> =&amp;gt; &lt;a href="https://httprunner.com/blog/user-survey-report">HttpRunner 首轮用户调研报告（2022.02）&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://wj.qq.com/s2/9708369/b6b2">HttpRunner 增值服务调研问卷&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://wj.qq.com/s2/10035362/b78e">QuickRunner 用户需求调研&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>通过调研问卷，我收集到了非常多宝贵的反馈和建议，这对 HttpRunner 的发展起到了非常重要的指引作用。&lt;/p>
&lt;p>在此非常感谢大家的积极参与，也希望大家后续可以通过这个途径给予 HttpRunner 更多的反馈（共性需求会高优实现哦~）。&lt;/p>
&lt;h3 id="issue-管理--版本规划">Issue 管理 &amp;amp; 版本规划&lt;/h3>
&lt;p>GitHub &lt;a href="https://github.com/httprunner/httprunner/issues">Issues&lt;/a> 是 HttpRunner 的项目需求管理工具，也是 HttpRunner 用户和开发者的主要交流渠道。&lt;/p>
&lt;p>大家在使用 HttpRunner 的过程遇到问题都可以通过 issue 反馈（建议先搜下是否有重复问题），我们通过其它渠道收集到的问题也会汇总到这里。&lt;/p>
&lt;p>同时为了更高效地管理 issues，HttpRunner 设置了多个维度的标签（Labels），每个 issue 会采用 1~N 个标签进行组合管理。具体可阅读 HttpRunner 的 &lt;a href="https://httprunner.com/docs/contribution-guidelines/issues/">Issue 管理机制&lt;/a>。&lt;/p>
&lt;p>另一方面，HttpRunner 从 v4.0 开始要做版本规划了。具体形式采用的是 GitHub 的里程碑（milestone）功能，每个版本会设定为一个里程碑，例如 v4.1、v4.2。然后我们会把所有的 issue（包括新功能、优化、bugfix 等）规划到具体版本中，并在 GitHub 的 &lt;a href="https://github.com/orgs/httprunner/projects/1">Projects&lt;/a> 中进行管理。&lt;/p>
&lt;p>如果大家想了解 HttpRunner 后续的版本规划，可以到 &lt;a href="https://github.com/orgs/httprunner/projects/1">Projects&lt;/a> 中进行查看。当然啦，需求规划后也会动态进行调整，如果你发现你想要的功能排期比较靠后，也可以多多进行反馈。还是那句话，共性需求会高优实现的。&lt;/p>
&lt;h3 id="用户使用文档">用户使用文档&lt;/h3>
&lt;p>在 &lt;a href="https://httprunner.com/blog/user-survey-report">HttpRunner 首轮用户调研报告（2022.02）&lt;/a> 中，用户使用文档相关的吐槽在所有问题中排名首位，远超其它问题。&lt;/p>
&lt;p>这个问题的确非常严重，我们在 v4.0 中必须得改！&lt;/p>
&lt;p>当前已经明确的改进措施有三条。&lt;/p>
&lt;ul>
&lt;li>用户文档统一采用中文编写，确保清晰易懂。&lt;/li>
&lt;li>梳理了一份文档计划，已经分工到核心开发者，后续会将文档编写安排到工作排期中。&lt;/li>
&lt;li>除了用户使用文档，我们还会针对大的功能特性通过博客介绍其原理机制，期待跟大家有更多的交流互动。&lt;/li>
&lt;/ul>
&lt;h3 id="用户交流社区">用户交流社区&lt;/h3>
&lt;p>HttpRunner 的交流途径挺多的，当前重点维护的包括：&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://testerhome.com/topics/node138">TesterHome 社区&lt;/a>：开设了 HttpRunner 主题板块，这也是 HttpRunner 项目的发源地&lt;/li>
&lt;li>&lt;a href="https://httprunner.com/image/qrcode.jpg">微信公众号&lt;/a>：不定期推送 HttpRunner 重点资讯（搜索 HttpRunner 进行关注）&lt;/li>
&lt;li>&lt;a href="https://github.com/httprunner/httprunner/discussions">GitHub Discussions&lt;/a>：GitHub 上开设的 discussions 社区板块（公告、想法、答疑、分享）&lt;/li>
&lt;li>微信交流群：为了保障交流质量特地设置了一些门槛，需要认真填写一份&lt;a href="https://httprunner.com/blog/user-survey/">调研问卷&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>如果上面的途径都无法满足你的需求，你也可以加我个人微信（leolee023），但需要在加好友的时候做下稍微详细点的自我介绍（至少包含姓名和所在公司，最好是再注明下期望交流的内容）。&lt;/p>
&lt;h2 id="总结">总结&lt;/h2>
&lt;p>以上便是 HttpRunner v4.0 发布将带来的主要变化。在今年的 MTSC 大会的开源专场，我也会对 HttpRunner v4.0 的设计思路和核心原理进行分享，到时候可以线下当面做更多的交流。&lt;/p>
&lt;p>最后再做个小预告，我们团队基于 HttpRunner 研发的一体化 API 测试工具 QuickRunner 已经完成了初版迭代，很快就要面向社区开放体验了，感兴趣的朋友可以先关注下。&lt;/p>
&lt;p>最后的最后，开源不易，要是 HttpRunner 对你有过帮助，麻烦帮忙给个 ⭐️star⭐️ 鼓励下吧。&lt;/p>
&lt;p>&lt;a href="https://github.com/httprunner/httprunner">https://github.com/httprunner/httprunner&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://httprunner.com/image/star-history.png" alt="">&lt;/p></description></item><item><title>Blog: HttpRunner 首轮用户调研报告（2022.02）</title><link>https://httprunner.com/blog/user-survey-report/</link><pubDate>Sun, 13 Feb 2022 00:00:00 +0000</pubDate><guid>https://httprunner.com/blog/user-survey-report/</guid><description>
&lt;p>2022.02.09，我发起了首轮面向 HttpRunner 用户的&lt;a href="https://httprunner.com/blog/user-survey">调研问卷&lt;/a>，截至当前，共收集到 252 份有效问卷。在此非常感谢所有填写问卷的朋友们，感谢你们的认可和建议！&lt;/p>
&lt;p>我最近也花了包括周末在内的整整 3 天时间逐一阅读了大家填写的内容，并对内容进行了整理汇总，最终形成了这份用户调研报告。&lt;/p>
&lt;p>本报告分为三个部分：客观统计数据、主观评价及建议、HttpRunner 的初步规划。文末会再说明下核心用户群的建设情况。&lt;/p>
&lt;h2 id="客观统计数据">客观统计数据&lt;/h2>
&lt;p>这部分是选择题，可以比较好地获得出各个维度的统计数据。&lt;/p>
&lt;h3 id="你当前使用的-httprunner-版本">你当前使用的 HttpRunner 版本？&lt;/h3>
&lt;p>&lt;img src="https://httprunner.com/image/user-survey-version.webp" alt="">&lt;/p>
&lt;p>HttpRunner 最开始是使用 Python 开发的，而当前采用 Golang 开发的 HttpRunner+ 还未开始推广，因此使用 Python 版的用户占比 95.2%，符合预期。&lt;/p>
&lt;p>在 Python 版本中，可以看出 74.2% 的用户已经在使用 HttpRunner v3.x 了，但还有近 20% 的用户在使用 v2.x，甚至 v1.x。从用户的问答题中，也有不少用户表明了更喜欢 v2.x 的形式。&lt;/p>
&lt;p>后续，Golang 版的 HttpRunner+ 将会是重点投入的方向，功能层面除了覆盖原 Python 版已有的功能外，还会在网络协议、性能测试、数字体验监测等方面进行更多的拓展。但大家可以放心，HttpRunner+ 虽然是采用 Golang 开发，但在使用方式方面会与原 Python 版基本保持一致，而且自定义函数后续会支持多种主流的编程语言（Go/Python/Java 等），因此不需要用户具备 Golang 的开发能力。同时，考虑到很多用户具有基于 Python 版 HttpRunner 进行二次开发的诉求，因此 Python 版的 v3.x 也会持续进行维护。&lt;/p>
&lt;h3 id="你对当前使用的-httprunner-整体满意度评分">你对当前使用的 HttpRunner 整体满意度评分？&lt;/h3>
&lt;p>&lt;img src="https://httprunner.com/image/user-survey-scores.webp" alt="">&lt;/p>
&lt;p>HttpRunner 当前整体满意度平均分 4.3。欣喜的是大家普遍给出的评分都是 4 星和 5 星，没有给出 1 星和 2 星的用户，在此非常感谢大家的认可和鼓励！&lt;/p>
&lt;h3 id="你重点关注的使用场景有哪些">你重点关注的使用场景有哪些？&lt;/h3>
&lt;p>&lt;img src="https://httprunner.com/image/user-survey-usage.webp" alt="">&lt;/p>
&lt;p>大家关注的使用场景主要聚焦在接口自动化测试、性能测试、线上监控 等，这也是之前 HttpRunner 项目的核心目标。&lt;/p>
&lt;p>而在数字体验监测（DEM）方面，大家的关注度明显偏低（4.2%），估计是数字体验监测还是一个比较新的概念，很多公司还没有开始重视。但可以明确告诉大家的是，数字体验监测（DEM）具有非常大的业务价值收益，后续 HttpRunner+ 也会重点加强这方面的能力建设，并且会分享较多的教程文档、成功案例，甚至公开课等。&lt;/p>
&lt;h3 id="你是否愿意与-httprunner-共创成功案例在-httprunner-官网上宣传展示">你是否愿意与 HttpRunner 共创成功案例？（在 HttpRunner 官网上宣传展示）&lt;/h3>
&lt;p>&lt;img src="https://httprunner.com/image/user-survey-cocreate-case.webp" alt="">&lt;/p>
&lt;p>愿意与 HttpRunner 共创成功案例的用户达到了 60.1%，着实令我感动。&lt;/p>
&lt;p>在此我也想说明的是，共创成功案例是一个双赢的事情，后续 HttpRunner 会加大开源项目运营力度。对HttpRunner 而言，我们期望能触达更多用户，将开源项目做大做强。对企业而言，HttpRunner 可以成为一个品牌宣传的渠道，团队宣传和招聘广告都是欢迎的。&lt;/p>
&lt;p>接下来我会整理下共创成功案例的方案和计划，然后跟有意向的朋友联系进行细节沟通。看到这里感兴趣的朋友，也可以主动跟我联系。&lt;/p>
&lt;h2 id="主观评价及建议">主观评价及建议&lt;/h2>
&lt;p>这部分是问答题，可以最真实准确地获得用户对 HttpRunner 的使用感受，同时也可以比较好地作为核心用户群体的筛选条件。&lt;/p>
&lt;p>最开始我想过采用多选题的方式，我自己罗列一些点，让大家进行选择。这样的好处是问卷填写和统计都非常方便，用户和我都会轻松得多。但坏处就是我个人的主观判断会严重影响到用户的评价，从而掩盖了最真实的用户声音。另外这种方式也没法区分出真正的铁杆用户，不利于核心用户群体的筛选。&lt;/p>
&lt;p>实际上，这部分整理工作的确也花费了我非常多的时间，主要是要对大家填写的内容进行结构化和归类，从而筛选出高优共性问题。但最后从实际结果来看，这部分投入真的非常值得！&lt;/p>
&lt;p>统计说明：统计次数都是基于针对具体维度的评价，笼统的描述不计入统计，例如「非常好用」、「都喜欢」等。同时单个用户针对多个维度的具体评价，都会计入到统计数据。
如果大家期望看到原始的问卷内容，可在公众号 HttpRunner 中发送「首轮问卷原始内容」获得查看链接（已去除用户个人相关信息）。&lt;/p>
&lt;h3 id="在当前使用的-httprunner-版本中你最喜欢的功能有哪些">在当前使用的 HttpRunner 版本中，你最喜欢的功能有哪些？👍&lt;/h3>
&lt;p>&lt;img src="https://httprunner.com/image/user-survey-likes.webp" alt="">&lt;/p>
&lt;p>从统计数据来看，HttpRunner 用户最喜欢的三大方面分别为：脚本能力、易用性、整体设计；并且票数显著高于其它方面。&lt;/p>
&lt;p>在细分功能层面，HttpRunner 用户最喜欢的功能点为：用例生成（har2case）、动态函数（debugtalk.py）、整体设计（用例分层）。&lt;/p>
&lt;h3 id="在当前使用的-httprunner-版本中你最想吐槽的点有哪些">在当前使用的 HttpRunner 版本中，你最想吐槽的点有哪些？👎&lt;/h3>
&lt;p>&lt;img src="https://httprunner.com/image/user-survey-dislikes.webp" alt="">&lt;/p>
&lt;p>在吐槽点方面，首当其冲是文档指引，票数显著高于其它维度。然后其它的吐槽点主要聚集在：易用性（缺乏 UI 界面）、问题排查（报错信息排查定位）、流程控制、性能测试（locust 鸡肋）等方面。&lt;/p>
&lt;h3 id="你最期望-httprunner-增加的功能有哪些">你最期望 HttpRunner 增加的功能有哪些？👻&lt;/h3>
&lt;p>&lt;img src="https://httprunner.com/image/user-survey-suggestions.webp" alt="">&lt;/p>
&lt;p>在期待新增的功能和改进方面，更高的易用性（UI 界面）、更完善的性能测试、更丰富的网络协议 是呼声最高的三个方向。同时在项目支持层面，文档、案例、demo 也是大家普遍期望改进的。&lt;/p>
&lt;h2 id="httprunner-的初步规划">HttpRunner 的初步规划&lt;/h2>
&lt;p>基于本轮用户调研的结果，我们可以看到 HttpRunner 具有一些亮点和优势，但同时还存在非常多的不足。我们会认真听取用户的反馈，并进行相应的改进，这也是我发起本轮用户调研问卷的初衷。&lt;/p>
&lt;p>这里先罗列一些初步的规划，后续我会再发布一份更完整的规划文档。&lt;/p>
&lt;h3 id="1承诺永久保持开源免费">1、承诺永久保持开源免费！&lt;/h3>
&lt;p>在问卷中有朋友提到了这样的期望，虽然只有一位，但我想在此进行下郑重申明。&lt;/p>
&lt;p>HttpRunner，以及当前重点投入的 HttpRunner+，承诺会永久保持开源免费。并且在开源协议上，我们选择了非常宽松的 Apache-2.0 协议，不管是对个人还是商业化公司，都十分友好，大家不需要有任何顾虑。&lt;/p>
&lt;p>但同时需要说明的是，HttpRunner 自身在保持开源免费的情况下，不排除我们会基于 HttpRunner 提供一些商业化的增值服务，后续也可能会有一些商业化的广告。期望大家能多多理解，在方便的时候也期待大家能给予支持，毕竟纯粹的靠爱发电是无法长久的，能找到一些利益平衡点，互惠互利才能走得更远！&lt;/p>
&lt;h3 id="2httprunner-开源社区建设">2、HttpRunner 开源社区建设&lt;/h3>
&lt;p>在针对 HttpRunner 的吐槽和期望改进方面，用户支持、文档案例建设、交流途径 被提及的比较多，这的确是当前 HttpRunner 做得很不好，严重阻碍 HttpRunner 普及和发展的问题。&lt;/p>
&lt;p>接下来，HttpRunner 会重点加强文档（中文优先）的建设，并且会设计一些案例，方便用户快速上手实践。甚至我们也在考虑可以定期搞一些 HttpRunner 的公开课，直播进行案例演示，对某些新手用户可能会更友好些。&lt;/p>
&lt;p>同时，我最近也在考虑建设 HttpRunner 自身的交流社区，方便用户更好地交流，及时获得问题答疑。构建核心用户群是当前第一阶段在做的工作，但更多具体形式我还在探索中，核心目标就是要解决大家在问卷中提到的相关问题。&lt;/p>
&lt;h3 id="3基于-httprunner-的-ui-客户端产品">3、基于 HttpRunner 的 UI 客户端产品&lt;/h3>
&lt;p>之前我在&lt;a href="https://debugtalk.com/post/my-2021-summary/">我的 2021 年终总结&lt;/a>中有简单介绍过，我们团队当前在基于 HttpRunner+ 研发一款商业化的桌面客户端性能检测（压测）工具，简单易用、功能强大是该产品最核心的目标。&lt;/p>
&lt;p>虽然核心目标是压测，但压测的基础是接口测试，因此该产品同样会具有接口自动化测试的所有功能。而在商业化方面，我们期望能有更广大的用户群体，因此绝大多数基础功能都会免费开放给用户。&lt;/p>
&lt;p>大概在今年 3 月份，我们的 UI 客户端工具 alpha 版本会先面向 HttpRunner 核心用户群开放试用，后续会逐步开放给更多用户。相信后续在有了该款 UI 客户端工具之后，问卷中普遍提及的易用性（缺乏 UI 操作界面）、性能测试不完善等问题就可以得到较好的解决。&lt;/p>
&lt;h3 id="4httprunner-的迭代方向">4、HttpRunner+ 的迭代方向&lt;/h3>
&lt;p>首先，HttpRunner+ 会延续之前的项目目标，打造成一个面向 HTTP(S) 的一站式测试解决方案。因此大家在问卷中反馈的共性问题（票数&amp;gt;=3）我们都会按照优先级进行解决。&lt;/p>
&lt;p>其次，HttpRunner+ 在应用场景上会进行更多的拓展和突破，包括覆盖更多的网络协议、支持更完善的性能测试、融合数字体验监测等更多能力。&lt;/p>
&lt;p>下图中展示了当前 HttpRunner+ 已经具备的能力，以及近期要重点实现的功能特性。&lt;/p>
&lt;p>&lt;img src="https://httprunner.com/image/hrp-features-202202.webp" alt="">&lt;/p>
&lt;h2 id="核心用户群的建设情况">核心用户群的建设情况&lt;/h2>
&lt;p>在首轮用户调研问卷之后，我逐一阅读了收集的所有问卷内容，并初步与一批用户进行联系，组建了一个微信交流群，当前群成员大概有 50+ 的样子。&lt;/p>
&lt;p>还有一些用户的填写质量也非常高，但有的是没有留下联系方式，有的是填写的联系方式无法添加好友，有的是添加好友申请后一直没有通过，还有的是添加好友成功后没有交流。如果存在这些情况的用户，麻烦再跟我联系下。&lt;/p>
&lt;p>另外我再说明下，我并不是在有意控制群的规模，而是期望在社区建设初期能筛选出一批真正喜欢 HttpRunner，并愿意一起帮助 HttpRunner 成长的用户。筛选机制可能存在一定的主观性，但大家如果去看下问卷的原始内容，也许就会清楚真正的铁杆用户具有怎样的特性了。&lt;/p>
&lt;p>查看原始问卷内容的方式：在公众号 HttpRunner 中发送「首轮问卷原始内容」获得查看链接（已去除用户个人相关信息）。&lt;/p>
&lt;p>最后，如果还有特别想进群的用户，那就再加下我微信（leolee023）吧，但需要在加好友的时候做下稍微详细点的自我介绍，包括：姓名、所在公司、所在公司使用 HttpRunner 的情况。&lt;/p>
&lt;hr>
&lt;p>最后的最后，麻烦大家再填个&lt;a href="https://wj.qq.com/s2/9708369/b6b2/">【问卷】&lt;/a>吧，只有一个问题，&lt;code>在 HttpRunner 永久保持开源免费的情况下，你最期望获得的增值服务有哪些？&lt;/code>&lt;/p>
&lt;p>再次感谢大家的理解和支持！&lt;/p>
&lt;p>问卷链接：https://wj.qq.com/s2/9708369/b6b2/&lt;/p></description></item><item><title>Blog: HttpRunner 核心用户招募中，你要加群么？</title><link>https://httprunner.com/blog/user-survey/</link><pubDate>Wed, 09 Feb 2022 00:00:00 +0000</pubDate><guid>https://httprunner.com/blog/user-survey/</guid><description>
&lt;p>大家好！非常感谢大家一直以来对 HttpRunner 的关注和支持！&lt;/p>
&lt;p>在&lt;a href="https://debugtalk.com/post/my-2021-summary/">我的 2021 年终总结&lt;/a>中，我说过我今年将会重点投入到 HttpRunner 的开发迭代和用户社区运营，近期我也在梳理具体的工作计划，估计很快就会同步给大家。&lt;/p>
&lt;p>首先，我想先建立一个 HttpRunner 的核心用户交流群，这也是之前众多用户呼吁已久的想法。这个群谢绝吹水，仅限 HttpRunner 相关的技术交流，包括新版本发布同步、新特性规划设计、问题反馈、用法咨询、最佳实践分享等等。后续待我们基于 HttpRunner 研发的桌面客户端压测工具发布后，也会第一时间发布到该用户群供大家体验试用。&lt;/p>
&lt;p>那怎么提升交流群的质量呢？&lt;/p>
&lt;p>我想最好的方式还是设置一些门槛，虽然会麻烦些，但应该是值得的。如果你期望加群，请填写&lt;a href="https://wj.qq.com/s2/9699514/0d19/">用户调研问卷&lt;/a>并留下你的微信号，作者会添加你的微信并拉你进群（填写不认真的将自动忽略哈）。&lt;/p></description></item></channel></rss>